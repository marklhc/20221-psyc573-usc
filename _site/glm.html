<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>PSYC 573 Bayesian Data Analysis (2022 Spring): Generalized Linear Model I</title>


  <link rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-03-13"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-03-13"/>
  <meta name="article:author" content="Mark Lai"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="PSYC 573 Bayesian Data Analysis (2022 Spring): Generalized Linear Model I"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="PSYC 573 Bayesian Data Analysis (2022 Spring)"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="PSYC 573 Bayesian Data Analysis (2022 Spring): Generalized Linear Model I"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date"]}},"value":[{"type":"character","attributes":{},"value":["Generalized Linear Model I"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Mark Lai"]}]}]},{"type":"character","attributes":{},"value":["March 13, 2022"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */
  @import url('https://fonts.googleapis.com/css2?family=Ubuntu');


  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #990000;
    --header-color:    rgba(153, 27, 30, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    'Ubuntu', sans-serif;
    --mono-font:       monospace;
    --body-font:       'Ubuntu', sans-serif;
    --navbar-font:     'Source Sans Pro', sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #1F1C0F;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #1F1C0F;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */

  /* code block bg */

  d-article pre {
      overflow: auto !important;
  }

  d-article div.sourceCode pre {
      background-color: rgba(255, 204, 0, 0.05);
  	padding-top: 5px;
  	padding-bottom: 5px;
  	overflow: auto !important;
  }

  /* inline code bg */

  d-article p code,
  d-article aside code {
      background: rgba(0, 0, 0, 0.05);
  }</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
  <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="site_libs/clipboard-2.0.6/clipboard.min.js"></script>
  <link href="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
  <script src="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
  <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clone fa-sm\" style=\"color: #301e64\"><\/i>","success":"<i class=\"fa fa-check fa-sm\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times fa-sm\" style=\"color: #F94144\"><\/i>"})</script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <style type="text/css">
  html {
    scroll-behavior: auto;
  }
  d-article {
      contain: none;
  }

  /* the value in left: will allow you to change the left edge gap */
  /* try using the value I have provided and check if the text goes beyond */
  /* the edge of the screen when you hover over using the mouse pointer */
  /* otherwise modify the values till you get a desirable result */

  @media screen and (min-width: 1000px) {
    #TOC {
      position: fixed;
      z-index: 50;
      left: 1.5em; /* changes the left edge gap */
      top: 6em; /* changes the top edge gap */
      max-width: 14%;
      overflow: auto;
    }
  }
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="fixed_toc.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Generalized Linear Model I","authors":[{"author":"Mark Lai","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-03-13T00:00:00.000-08:00","citationText":"Lai, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">PSYC 573 Bayesian Data Analysis (2022 Spring)</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="syllabus.html">Syllabus</a>
<a href="modules.html">Modules</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Notes
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="r_markdown.html">R Markdown</a>
<a href="r_basics.html">R Basics</a>
<a href="probability.html">Probability</a>
<a href="bayes_rule.html">Bayes' Rule</a>
<a href="beta_Bernoulli_model.html">Beta-Bernoulli Model</a>
<a href="Poisson_model.html">(Bonus) Poisson Model</a>
<a href="mcmc.html">MCMC: Metropolis</a>
<a href="gibbs.html">MCMC: Gibbs</a>
<a href="hmc_stan.html">HMC and Stan</a>
<a href="hierarchical_models.html">Hierarchical Models</a>
<a href="group_comparisons.html">Group Comparisons</a>
<a href="glm.html">Generalized Linear Model I</a>
</div>
</div>
<a href="https://github.com/marklhc/20221-psyc573-usc" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Generalized Linear Model I</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  
  Mark Lai
  
<br/>March 13, 2022
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#what-is-regression">What is Regression?</a></li>
<li><a href="#overview-of-glm">Overview of GLM</a></li>
<li><a href="#linear-regression">Linear Regression</a>
<ul>
<li><a href="#example">Example</a></li>
<li><a href="#model-and-priors">Model and Priors</a></li>
<li><a href="#with-stan">With Stan</a></li>
<li><a href="#with-brms">With <code>brms</code></a>
<ul>
<li><a href="#set-priors">Set priors</a></li>
<li><a href="#convergence">Convergence</a></li>
<li><a href="#posterior-plots">Posterior plots</a></li>
<li><a href="#table">Table</a></li>
</ul></li>
<li><a href="#predicting-a-new-data-point">Predicting a New Data
Point</a></li>
<li><a href="#robust-regression">Robust Regression</a></li>
</ul></li>
<li><a href="#poisson-regression">Poisson Regression</a>
<ul>
<li><a href="#model-and-priors-1">Model and Priors</a></li>
<li><a href="#mcmc-sampling-with-brms">MCMC Sampling With
<code>brms</code></a></li>
<li><a href="#interpretations">Interpretations</a></li>
<li><a href="#rootogram">Rootogram</a></li>
<li><a href="#negative-binomial-model">Negative Binomial Model</a></li>
<li><a href="#last-updated">Last updated</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>  <span class='co'># for easier management of file paths</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/rstan/'>rstan</a></span><span class='op'>)</span>
<span class='fu'><a href='https://mc-stan.org/rstan/reference/rstan_options.html'>rstan_options</a></span><span class='op'>(</span>auto_write <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>  <span class='co'># save compiled Stan object</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>  <span class='co'># simplify fitting Stan GLM models</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/shinystan/'>shinystan</a></span><span class='op'>)</span>  <span class='co'># graphical exploration</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/posterior/'>posterior</a></span><span class='op'>)</span>  <span class='co'># for summarizing draws</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/bayesplot/'>bayesplot</a></span><span class='op'>)</span>  <span class='co'># for plotting</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://vincentarelbundock.github.io/modelsummary/'>modelsummary</a></span><span class='op'>)</span>  <span class='co'># table for brms</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>theme_set</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid.major.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey92"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>GLM (generalized linear model) is a general class of statistical
models for predicting an outcome variable, <span
class="math inline">\(Y\)</span>. It accommodates <span
class="math inline">\(Y\)</span> in different types of measurement, such
as continuous, counts, ordinal, or categorical. GLM is a generalization
of the usual regression model that assumes linear associations and
normally distributed errors.</p>
<aside>
Just to be careful, some scholars also use the abbreviation GLM to mean
the <em>general</em> linear model, and the latter is actually the same
as the linear model, which is a special case of the GLM we will discuss
here. Here we discuss GLM (the generalized one) that is especially
popular for modeling binary and count outcomes, but we will start with
the linear regression case.
</aside>
<h1 id="what-is-regression">What is Regression?</h1>
<p>Regression is a class of statistical techniques to understand the
relationship between an outcome variable (also called a
criterion/response/dependent variable) and one or more predictor
variables (also called explanatory/independent variables). For example,
if we have the following scatter plot between two variables (<span
class="math inline">\(Y\)</span> and <span
class="math inline">\(X\)</span>):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>1</span>, <span class='fl'>5</span><span class='op'>)</span>, <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>0.7</span> <span class='op'>+</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span>, sd <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>
<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='co'># stat_function(fun = function(x) 0.7 + 0.5 * log(x - 1), n = 501) +</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/reg-curve-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We want to find some pattern from this relationship. In conventional
regression, we model the conditional distribution of <span
class="math inline">\(Y\)</span> given <span
class="math inline">\(X\)</span>, <span class="math inline">\(P(Y \mid
X)\)</span>, by separating the outcome variable <span
class="math inline">\(Y\)</span> into (a) a <em>systematic
component</em> that depends on the predictor, and (b) a
<em>random</em>/<em>probabilistic</em> component that does not depend on
the predictor. For example, we can start with a systematic component
which only depends on the predictor:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="glm_files/figure-html5/reg-systematic-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>As you can see, all the red dots fall exactly on the curve in the
graph above, meaning that as long as one knows the <span
class="math inline">\(X\)</span> value, one can predict the <span
class="math inline">\(Y\)</span> value with 100% accuracy. We can thus
write <span class="math inline">\(Y^* = f(X)\)</span> (where <span
class="math inline">\(Y^*\)</span> is the systematic component of <span
class="math inline">\(Y\)</span>).</p>
<p>However, in almost all scientific inquiries, one can never predict
with 100% certainty (e.g., there are measurement errors and college
randomness in physics). The uncertainty stems from the fact that we
rarely measure all the factors that determine <span
class="math inline">\(Y\)</span>, and there are genuinely random things
(as in quantum physics). Therefore, we need to expand our model to
incorporate this randomness, by adding a probabilistic component.
Therefore, instead of saying that <span class="math inline">\(Y\)</span>
depends just on <span class="math inline">\(X\)</span>, we say <span
class="math inline">\(Y\)</span> is random, but the information about
<span class="math inline">\(X\)</span> provides information about how
<span class="math inline">\(Y\)</span> is distributed. In regression,
one studies the conditional distribution <span class="math inline">\(P(Y
\mid X)\)</span> such that the conditional expectation, <span
class="math inline">\(E(Y \mid X)\)</span>, is determined by <span
class="math inline">\(X\)</span>; on top of the conditional expectation,
we assume that the observed <span class="math inline">\(Y\)</span>
values scatter around the conditional expectations, like the graph on
the left below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>yhat</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_function.html'>stat_function</a></span><span class='op'>(</span>fun <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fl'>0.7</span> <span class='op'>+</span> <span class='fl'>0.5</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>501</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>"y"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_curve</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>yhat</span> <span class='op'>+</span> <span class='fl'>0.5</span>, xend <span class='op'>=</span> <span class='va'>x</span>, yend <span class='op'>=</span> <span class='va'>yhat</span> <span class='op'>-</span> <span class='fl'>0.5</span><span class='op'>)</span>,
        curvature <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.4</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, linetype <span class='op'>=</span> <span class='st'>"dotdash"</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span>, linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'>gridExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html'>grid.arrange</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span>, nrow <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/reg-combo-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We can write the systematic part as:</p>
<p><span class="math display">\[E(Y \mid X) = f(X; \beta_1, \beta_2,
\ldots), \]</span></p>
<p>where <span class="math inline">\(\beta_1\)</span>, <span
class="math inline">\(\beta_2\)</span>, <span
class="math inline">\(\ldots\)</span> are the parameters for some
arbitrary function <span class="math inline">\(f(\cdot)\)</span>. The
random part is about <span class="math inline">\(P(Y \mid X)\)</span>,
which can take some arbitrary form of distributions. In reality, even if
such a model holds, we do not know what <span
class="math inline">\(f(\cdot)\)</span> and the true distribution of
<span class="math inline">\(Y \mid X\)</span> are, as we only have data
like those illustrated in the graph on the right above.</p>
<h1 id="overview-of-glm">Overview of GLM</h1>
<p>Under the GLM framework, with one predictor, we have models in the
form</p>
<p><span class="math display">\[
  \begin{aligned}
    Y_i &amp; \sim \mathrm{Dist}(\mu_i, \tau)  \\
    g(\mu_i) &amp; = \eta_i \\
    \eta_i &amp; = \beta_0 + \beta_1 X_i
  \end{aligned}
\]</span></p>
<p>A GLM model has three components:</p>
<ul>
<li>Conditional distribution of <span class="math inline">\(Y\)</span>
(e.g., Dist = Normal, Poisson, Binomial, Bernoulli)<a href="#fn1"
class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a></li>
<li>Linear predictor <span class="math inline">\(\eta\)</span>, which is
a linear combination of the predictor</li>
<li>Link function <span class="math inline">\(g(\cdot)\)</span>, which
maps <span class="math inline">\(\mu\)</span> to <span
class="math inline">\(\eta\)</span></li>
</ul>
<p>In a GLM, one selects distributions like Dist = Normal, Poisson,
Binomial, Bernoulli, etc. The distribution has a mean parameter <span
class="math inline">\(\mu_i\)</span> and may have a dispersion
parameter, <span class="math inline">\(\tau\)</span>. An intermediate
step in GLM is transforming <span class="math inline">\(\mu_i\)</span>
to <span class="math inline">\(\eta_i\)</span>. <span
class="math inline">\(\eta_i\)</span> is called the <em>linear
predictor</em>, which is the linear function of the predictors. In
linear models, we directly model the conditional mean, <span
class="math inline">\(\mu_i\)</span>, as the same as <span
class="math inline">\(\eta_i\)</span>. However, to allow for the
possibility of <span class="math inline">\(\mu_i\)</span> being a
nonlinear function of the predictors, in GLM we transform <span
class="math inline">\(\mu_i\)</span> by applying a <em>link
function</em>, <span class="math inline">\(g(\cdot)\)</span>, so that,
even though we <span class="math inline">\(\eta_i\)</span> to be linear
in the coefficients, <span class="math inline">\(\mu_i =
g^{-1}(\eta_i)\)</span> will be a nonlinear function of the coefficients
as long as the link function is not linear. This step is needed to
ensure that the predicted values will not be out of range.</p>
<p>The table below includes some commonly used GLMs</p>
<table style="width:100%;">
<colgroup>
<col style="width: 31%" />
<col style="width: 20%" />
<col style="width: 34%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">outcome type</th>
<th style="text-align: center;">Support</th>
<th style="text-align: center;">Distributions</th>
<th style="text-align: center;">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">continuous</td>
<td style="text-align: center;">[<span
class="math inline">\(-\infty\)</span>, <span
class="math inline">\(\infty\)</span>]</td>
<td style="text-align: center;">Normal</td>
<td style="text-align: center;">Identity</td>
</tr>
<tr class="even">
<td style="text-align: center;">count (fixed duration)</td>
<td style="text-align: center;">{0, 1, <span
class="math inline">\(\ldots\)</span>}</td>
<td style="text-align: center;">Poisson</td>
<td style="text-align: center;">Log</td>
</tr>
<tr class="odd">
<td style="text-align: center;">count (known # of trials)</td>
<td style="text-align: center;">{0, 1, <span
class="math inline">\(\ldots\)</span>, <span
class="math inline">\(N\)</span>}</td>
<td style="text-align: center;">Binomial</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">{0, 1}</td>
<td style="text-align: center;">Bernoulli</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ordinal</td>
<td style="text-align: center;">{0, 1, <span
class="math inline">\(\ldots\)</span>, K}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="even">
<td style="text-align: center;">nominal</td>
<td style="text-align: center;"><span
class="math inline">\(K\)</span>-vector of {0, 1}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
<tr class="odd">
<td style="text-align: center;">multinomial</td>
<td style="text-align: center;"><span
class="math inline">\(K\)</span>-vector of {0, 1, <span
class="math inline">\(\ldots\)</span>, <span
class="math inline">\(K\)</span>}</td>
<td style="text-align: center;">categorical</td>
<td style="text-align: center;">Logit</td>
</tr>
</tbody>
</table>
<h1 id="linear-regression">Linear Regression</h1>
<p>The linear regression model assumes that</p>
<ol type="a">
<li>the function for the systematic component, <span
class="math inline">\(f(\cdot)\)</span>, is a linear function (in the
<span class="math inline">\(\beta\)</span>s),</li>
<li><span class="math inline">\(Y \mid X\)</span> is normally
distributed, and</li>
<li><span class="math inline">\(Y_i\)</span>’s are conditionally
exchangeable given <span class="math inline">\(X\)</span> with equal
variance <span class="math inline">\(\sigma^2\)</span> (which can be
relaxed).</li>
</ol>
<p>Under these conditions, we have a model</p>
<p><span class="math display">\[
  \begin{aligned}
    Y_i &amp; \sim N(\mu_i, \sigma)  \\
    \mu_i &amp; = \eta_i \\
    \eta_i &amp; = \beta_0 + \beta_1 X_{i}
  \end{aligned}
\]</span></p>
<p>With parameters: - <span class="math inline">\(\beta_0\)</span>:
regression intercept; predicted <span class="math inline">\(Y\)</span>
value for observations with <span class="math inline">\(X\)</span> = 0 -
<span class="math inline">\(\beta_1\)</span>: regression
slope/coefficient; predicted difference in <span
class="math inline">\(Y\)</span> for one unit difference in <span
class="math inline">\(X\)</span> - <span
class="math inline">\(\sigma\)</span>: standard deviation of prediction
error; roughly speaking, the margin of error in prediction</p>
<h2 id="example">Example</h2>
<p>We will use an example based on the “bread and peace” model by
political scientist Douglas Hibbs, which can be used to forecast the
U.S. presidential election outcome based on some weighted metric of
personal income growth. The example is taken from chapter 7 of the book
<a href="https://avehtari.github.io/ROS-Examples/">Regression and Other
Stories</a>.</p>
<aside>
See <a
href="https://douglas-hibbs.com/background-information-on-bread-and-peace-voting-in-us-presidential-elections/"
class="uri">https://douglas-hibbs.com/background-information-on-bread-and-peace-voting-in-us-presidential-elections/</a>
for more information on the “bread and peace” model.
</aside>
<p>Below is a graph showing the data from 1952 to 2012, with one
variable being personal income growth in the four years prior to an
election, and the other being the vote share (in %) of the incumbent’s
party.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Economy and elections data</span>
<span class='va'>hibbs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.table</a></span><span class='op'>(</span>
    <span class='st'>"https://github.com/avehtari/ROS-Examples/raw/master/ElectionsEconomy/data/hibbs.dat"</span>,
    header <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>hibbs</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>growth</span>, y <span class='op'>=</span> <span class='va'>vote</span>, label <span class='op'>=</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Average recent growth in personal income"</span>,
         y <span class='op'>=</span> <span class='st'>"Incumbent party's vote share (%)"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/plot-hibbs-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="model-and-priors">Model and Priors</h2>
<p>Model:</p>
<p><span class="math display">\[\begin{align}
  \text{vote}_i &amp; \sim N(\mu_i, \sigma) \\
  \mu_i &amp; = \beta_0 + \beta_1 \text{growth}_i
\end{align}\]</span></p>
<p><span class="math inline">\(\sigma\)</span>: SD (margin) of
prediction error</p>
<p>Priors:</p>
<p><span class="math display">\[\begin{align}
  \beta_0 &amp; \sim N(45, 10)  \\
  \beta_1 &amp; \sim N(0, 10)  \\
  \sigma &amp; \sim t^+_4(0, 5)
\end{align}\]</span></p>
<h2 id="with-stan">With Stan</h2>
<p>Once you’ve written the model, it’s straightforward to code the model
in Stan to perform MCMC sampling, like the code below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb1"><pre
class="sourceCode stan"><code class="sourceCode stan"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;  <span class="co">// number of observations</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;  <span class="co">// outcome;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;  <span class="co">// predictor;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta0;  <span class="co">// regression intercept</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta1;  <span class="co">// regression coefficient</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;  <span class="co">// SD of prediction error</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// model</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  y ~ normal(beta0 + beta1 * x, sigma);</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prior</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  beta0 ~ normal(<span class="dv">45</span>, <span class="dv">10</span>);</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  beta1 ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  sigma ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y_rep;  <span class="co">// place holder</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    y_rep[n] = normal_rng(beta0 + beta1 * x[n], sigma);</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"stan"</span>, <span class='st'>"linear_reg.stan"</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>hibbs</span><span class='op'>)</span>,
                y <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>vote</span>,
                x <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>growth</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="with-brms">With <code>brms</code></h2>
<p>While Stan is very flexible, because GLM is so widely used, some
authors have created packages that would further simplify the fitting of
Bayesian GLMs (and some other models). One of those packages is
<code>brms</code>, which I believe stands for “Bayesian regression
models with Stan.” It allows one to do MCMC sampling using Stan, but
with syntax similar to that in R functions <code>lm()</code>,
<code>glm()</code>, and <code>lme4::lmer()</code>. <code>brms</code>
probably supports more models than any R packages that statisticians
routinely used; there are models, like factor analysis, that are not
directly supported. If you came across some fancy regression models,
chances are you can do something similar in <code>brms</code>. You can
find some resources for learning <code>brms</code> on this page: <a
href="https://paul-buerkner.github.io/brms/"
class="uri">https://paul-buerkner.github.io/brms/</a></p>
<h3 id="set-priors">Set priors</h3>
<p><code>brms</code> comes with some default prior options, but I
recommend you always check what priors are used and think about whether
they make sense for your data. You can use <code>get_priors()</code> to
show the default priors used in <code>brms</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/get_prior.html'>get_prior</a></span><span class='op'>(</span><span class='va'>vote</span> <span class='op'>~</span> <span class='va'>growth</span>,
    data <span class='op'>=</span> <span class='va'>hibbs</span>,
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>#&gt;                    prior     class   coef group resp dpar nlpar bound
#&gt;                   (flat)         b                                   
#&gt;                   (flat)         b growth                            
#&gt;  student_t(3, 50.8, 6.1) Intercept                                   
#&gt;     student_t(3, 0, 6.1)     sigma                                   
#&gt;        source
#&gt;       default
#&gt;  (vectorized)
#&gt;       default
#&gt;       default</code></pre>
</div>
<p>To do MCMC sampling, we use the <code>brm()</code> function. The
first argument is a formula in R. The variable before <code>~</code> is
the outcome, whereas the ones after <code>~</code> are the predictors.
For example,</p>
<pre><code>vote ~ 1 + growth</code></pre>
<p>means the model</p>
<p><span class="math display">\[E(\text{vote}_i) = \beta_0 (1) + \beta_1
(\text{growth}_i).\]</span></p>
<p>Usually, I write <code>vote ~ 1 + growth</code> as
<code>vote ~ growth</code>, as the <code>1 +</code> part is
automatically added.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m1_brm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span>
    <span class='co'># Y (vote) = beta0 + beta1 (growth)</span>
    <span class='va'>vote</span> <span class='op'>~</span> <span class='va'>growth</span>,
    data <span class='op'>=</span> <span class='va'>hibbs</span>,
    <span class='co'># Normal distribution with identity link</span>
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span>,
    <span class='co'># Overwrite the default priors</span>
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='co'># prior for beta0</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>45</span>, <span class='fl'>10</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span>,
        <span class='co'># prior for beta1 (and beta2, ..., if &gt; 1 predictors)</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>10</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>,
        <span class='co'># prior for sigma</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>
    <span class='op'>)</span>,
    sample_prior <span class='op'>=</span> <span class='cn'>TRUE</span>,  <span class='co'># also sample the prior distributions</span>
    iter <span class='op'>=</span> <span class='fl'>4000</span>,  <span class='co'># default is 4 chains, 2000 iterations each</span>
    seed <span class='op'>=</span> <span class='fl'>31143</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>#&gt; 
#&gt; SAMPLING FOR MODEL &#39;c5e219d81e0627b524a280eeeb9a9fcc&#39; NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 1.1e-05 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.11 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 1: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 0.035698 seconds (Warm-up)
#&gt; Chain 1:                0.03708 seconds (Sampling)
#&gt; Chain 1:                0.072778 seconds (Total)
#&gt; Chain 1: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;c5e219d81e0627b524a280eeeb9a9fcc&#39; NOW (CHAIN 2).
#&gt; Chain 2: 
#&gt; Chain 2: Gradient evaluation took 5e-06 seconds
#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.05 seconds.
#&gt; Chain 2: Adjust your expectations accordingly!
#&gt; Chain 2: 
#&gt; Chain 2: 
#&gt; Chain 2: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 2: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 2: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 2: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 2: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 2: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 2: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 2: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 2: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 2: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 2: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 2: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 2: 
#&gt; Chain 2:  Elapsed Time: 0.041118 seconds (Warm-up)
#&gt; Chain 2:                0.044539 seconds (Sampling)
#&gt; Chain 2:                0.085657 seconds (Total)
#&gt; Chain 2: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;c5e219d81e0627b524a280eeeb9a9fcc&#39; NOW (CHAIN 3).
#&gt; Chain 3: 
#&gt; Chain 3: Gradient evaluation took 8e-06 seconds
#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.08 seconds.
#&gt; Chain 3: Adjust your expectations accordingly!
#&gt; Chain 3: 
#&gt; Chain 3: 
#&gt; Chain 3: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 3: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 3: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 3: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 3: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 3: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 3: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 3: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 3: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 3: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 3: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 3: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 3: 
#&gt; Chain 3:  Elapsed Time: 0.044921 seconds (Warm-up)
#&gt; Chain 3:                0.046009 seconds (Sampling)
#&gt; Chain 3:                0.09093 seconds (Total)
#&gt; Chain 3: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;c5e219d81e0627b524a280eeeb9a9fcc&#39; NOW (CHAIN 4).
#&gt; Chain 4: 
#&gt; Chain 4: Gradient evaluation took 6e-06 seconds
#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.06 seconds.
#&gt; Chain 4: Adjust your expectations accordingly!
#&gt; Chain 4: 
#&gt; Chain 4: 
#&gt; Chain 4: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 4: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 4: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 4: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 4: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 4: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 4: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 4: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 4: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 4: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 4: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 4: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 4: 
#&gt; Chain 4:  Elapsed Time: 0.04162 seconds (Warm-up)
#&gt; Chain 4:                0.04394 seconds (Sampling)
#&gt; Chain 4:                0.08556 seconds (Total)
#&gt; Chain 4:</code></pre>
</div>
<p>You can print the results</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>m1_brm</span>, digits <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>  <span class='co'># `digits = 2` is default</span>
</code></pre>
</div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: vote ~ growth 
#&gt;    Data: hibbs (Number of observations: 16) 
#&gt;   Draws: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
#&gt;          total post-warmup draws = 8000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept    46.18      1.75    42.69    49.65 1.00     6349     4916
#&gt; growth        3.05      0.75     1.58     4.56 1.00     6209     4702
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     4.01      0.82     2.79     5.93 1.00     5192     4789
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<p>The coefficients under <code>Population-Level Effects</code> are the
<span class="math inline">\(\beta\)</span>s, and those under
<code>Family Specific Parameters</code> are the <span
class="math inline">\(\tau\)</span>s (scale parameters). The one labeled
<code>Intercept</code> is <span class="math inline">\(\beta_0\)</span>,
and the one labeled <code>growth</code> is the coefficient for the
<code>growth</code> predictor, which is <span
class="math inline">\(\beta_1\)</span>.</p>
<p>Here’s a paragraph for the results:</p>
<blockquote>
<p>The model predicts that when personal income growth is 0, the vote
share for the incumbent party is 46.18%, 90% CI [43.31%, 49.04%]. A 1
unit difference in personal income growth corresponds to a difference in
vote share by 3.05 precentage points, 90% CI [1.82, 4.28].</p>
</blockquote>
<h3 id="convergence">Convergence</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-traces.html'>mcmc_trace</a></span><span class='op'>(</span><span class='va'>m1_brm</span>,
           pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"b_Intercept"</span>, <span class='st'>"b_growth"</span>, <span class='st'>"sigma"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="glm_files/figure-html5/m1-conv-1.png" width="70%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-traces.html'>mcmc_rank_hist</a></span><span class='op'>(</span><span class='va'>m1_brm</span>,
               pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"b_Intercept"</span>, <span class='st'>"b_growth"</span>, <span class='st'>"sigma"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m1-conv-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h3 id="posterior-plots">Posterior plots</h3>
<p>There are many ways to visualize the results of a regression model.
<strong>The most important thing is to be as familiar with what the
results mean as possible.</strong> Statistics is not some magic that
gives you some numbers that either support or do not support your theory
or hypothesis. It is a way to describe your data. <strong>If you do not
want to do the work to understand what your data tell you, why bother to
collect the data in the first place?</strong></p>
<h4 id="posterior-density">Posterior density</h4>
<p>Posterior distributions of the three parameters</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-distributions.html'>mcmc_dens</a></span><span class='op'>(</span><span class='va'>m1_brm</span>,
          pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"b_Intercept"</span>, <span class='st'>"b_growth"</span>, <span class='st'>"sigma"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m1-dens-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>You can also combine the density plot and the trace plot</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>m1_brm</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m1-combo-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="plot-regression-prediction">Plot regression prediction</h4>
<p>The plot below shows the 50% and 90% prediction intervals based on
the posterior samples and the model. For example, with the 90%
intervals, one expects 90% of the data should be within those intervals.
If you see many data points lying outside the intervals, the linear
model is not a good fit.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span>
    <span class='va'>m1_brm</span>,
    type <span class='op'>=</span> <span class='st'>"intervals"</span>,
    x <span class='op'>=</span> <span class='st'>"growth"</span>
<span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"growth"</span>, y <span class='op'>=</span> <span class='st'>"predicted vote"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_label_repel</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>vote</span>, label <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m1-pp-check-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="plot-priors-and-posteriors-together">Plot priors and posteriors
together</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>h_growth</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/hypothesis.brmsfit.html'>hypothesis</a></span><span class='op'>(</span><span class='va'>m1_brm</span>,
    hypothesis <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"growth = 0"</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>h_growth</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/h_growth-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h3 id="table">Table</h3>
<p>You can use the <code>modelsummary::msummary()</code> function to get
a nicely formatted table of GLM coefficients. We’ll talk about things
like ELPD, LOOIC, and WAIC later in the course.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/msummary.html'>msummary</a></span><span class='op'>(</span><span class='va'>m1_brm</span>, statistic <span class='op'>=</span> <span class='st'>"conf.int"</span>, fmt <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:center;">
46.20
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
[42.78, 49.71]
</td>
</tr>
<tr>
<td style="text-align:left;">
b_growth
</td>
<td style="text-align:center;">
3.05
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
[1.55, 4.52]
</td>
</tr>
<tr>
<td style="text-align:left;">
sigma
</td>
<td style="text-align:center;">
3.88
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
[2.64, 5.65]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD
</td>
<td style="text-align:center;">
−46.4
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD s.e.
</td>
<td style="text-align:center;">
3.8
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC
</td>
<td style="text-align:center;">
92.9
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC s.e.
</td>
<td style="text-align:center;">
7.6
</td>
</tr>
<tr>
<td style="text-align:left;">
WAIC
</td>
<td style="text-align:center;">
92.3
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:center;">
24.96
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="predicting-a-new-data-point">Predicting a New Data Point</h2>
<p>In the four years before 2016, the weighted average personal income
growth was 2.0 (based on Hibbs’ calculation). So based on the model, we
can obtain a posterior distribution for the predicted vote share of the
Democratic Party, which is the incumbent party prior to the 2016
presidential election.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pp_growth_eq_2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/posterior_predict.brmsfit.html'>posterior_predict</a></span><span class='op'>(</span><span class='va'>m1_brm</span>,
    newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>growth <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>pp_growth_eq_2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"y_tilde"</span>
<span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-distributions.html'>mcmc_dens</a></span><span class='op'>(</span><span class='va'>pp_growth_eq_2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/pp_growth_eq2-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>The probability of incumbent’s vote share &gt; 50% with average
income growth = 2 is 0.72625. The actual outcome of the election was
that the Democratic Party received about 51.1% of the votes among the
two parties, so it was below the model prediction but within the range
of possible outcomes. Of course, we know that the actual election
outcome is based on the electoral college, not the majority vote.</p>
<h2 id="robust-regression">Robust Regression</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m1_robust</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>vote</span> <span class='op'>~</span> <span class='va'>growth</span>,
    data <span class='op'>=</span> <span class='va'>hibbs</span>,
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>student</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span>,
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>45</span>, <span class='fl'>10</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>10</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Special.html'>gamma</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>0.1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"nu"</span><span class='op'>)</span>
    <span class='op'>)</span>,
    sample_prior <span class='op'>=</span> <span class='cn'>TRUE</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>,
    seed <span class='op'>=</span> <span class='fl'>31143</span>
<span class='op'>)</span>
</code></pre>
</div>
<pre><code>#&gt; 
#&gt; SAMPLING FOR MODEL &#39;2c7d149b9ab4ebcb5b7c52747ae84e15&#39; NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 2e-05 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.2 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 1: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 0.073485 seconds (Warm-up)
#&gt; Chain 1:                0.070148 seconds (Sampling)
#&gt; Chain 1:                0.143633 seconds (Total)
#&gt; Chain 1: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;2c7d149b9ab4ebcb5b7c52747ae84e15&#39; NOW (CHAIN 2).
#&gt; Chain 2: 
#&gt; Chain 2: Gradient evaluation took 2.3e-05 seconds
#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
#&gt; Chain 2: Adjust your expectations accordingly!
#&gt; Chain 2: 
#&gt; Chain 2: 
#&gt; Chain 2: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 2: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 2: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 2: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 2: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 2: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 2: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 2: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 2: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 2: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 2: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 2: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 2: 
#&gt; Chain 2:  Elapsed Time: 0.07276 seconds (Warm-up)
#&gt; Chain 2:                0.083175 seconds (Sampling)
#&gt; Chain 2:                0.155935 seconds (Total)
#&gt; Chain 2: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;2c7d149b9ab4ebcb5b7c52747ae84e15&#39; NOW (CHAIN 3).
#&gt; Chain 3: 
#&gt; Chain 3: Gradient evaluation took 1.8e-05 seconds
#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.
#&gt; Chain 3: Adjust your expectations accordingly!
#&gt; Chain 3: 
#&gt; Chain 3: 
#&gt; Chain 3: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 3: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 3: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 3: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 3: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 3: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 3: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 3: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 3: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 3: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 3: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 3: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 3: 
#&gt; Chain 3:  Elapsed Time: 0.106353 seconds (Warm-up)
#&gt; Chain 3:                0.109373 seconds (Sampling)
#&gt; Chain 3:                0.215726 seconds (Total)
#&gt; Chain 3: 
#&gt; 
#&gt; SAMPLING FOR MODEL &#39;2c7d149b9ab4ebcb5b7c52747ae84e15&#39; NOW (CHAIN 4).
#&gt; Chain 4: 
#&gt; Chain 4: Gradient evaluation took 1.8e-05 seconds
#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.
#&gt; Chain 4: Adjust your expectations accordingly!
#&gt; Chain 4: 
#&gt; Chain 4: 
#&gt; Chain 4: Iteration:    1 / 4000 [  0%]  (Warmup)
#&gt; Chain 4: Iteration:  400 / 4000 [ 10%]  (Warmup)
#&gt; Chain 4: Iteration:  800 / 4000 [ 20%]  (Warmup)
#&gt; Chain 4: Iteration: 1200 / 4000 [ 30%]  (Warmup)
#&gt; Chain 4: Iteration: 1600 / 4000 [ 40%]  (Warmup)
#&gt; Chain 4: Iteration: 2000 / 4000 [ 50%]  (Warmup)
#&gt; Chain 4: Iteration: 2001 / 4000 [ 50%]  (Sampling)
#&gt; Chain 4: Iteration: 2400 / 4000 [ 60%]  (Sampling)
#&gt; Chain 4: Iteration: 2800 / 4000 [ 70%]  (Sampling)
#&gt; Chain 4: Iteration: 3200 / 4000 [ 80%]  (Sampling)
#&gt; Chain 4: Iteration: 3600 / 4000 [ 90%]  (Sampling)
#&gt; Chain 4: Iteration: 4000 / 4000 [100%]  (Sampling)
#&gt; Chain 4: 
#&gt; Chain 4:  Elapsed Time: 0.131682 seconds (Warm-up)
#&gt; Chain 4:                0.116059 seconds (Sampling)
#&gt; Chain 4:                0.247741 seconds (Total)
#&gt; Chain 4:</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span>
    <span class='va'>m1_robust</span>,
    type <span class='op'>=</span> <span class='st'>"intervals"</span>,
    x <span class='op'>=</span> <span class='st'>"growth"</span>
<span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"growth"</span>, y <span class='op'>=</span> <span class='st'>"predicted vote"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_label_repel</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>vote</span>, label <span class='op'>=</span> <span class='va'>hibbs</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span>
    <span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m1-pp-check-robust-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<h1 id="poisson-regression">Poisson Regression</h1>
<p>The Poisson GLM is used to model count outcomes. Count outcomes are
non-negative discrete integers. Remember, with GLM, we are modeling the
mean of the outcome, <span class="math inline">\(\mu\)</span>.
Therefore, we need to make sure <span class="math inline">\(\mu\)</span>
is non-negative, so we need a link function that can map <span
class="math inline">\(\eta\)</span> from the whole real line to
non-negative numbers; by far, the most commonly used link function is
the logarithmic transformation, <span class="math inline">\(g(\mu) =
\log(\mu)\)</span>.</p>
<p>Here’s an example data set recording effect of anticonvulsant therapy
in epilepsy. The outcome variable is the number of seizures in the
two-week window prior to the last of the four visits.</p>
<p>First check the distribution of the counts:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>epilepsy4</span> <span class='op'>&lt;-</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>epilepsy</span>, <span class='va'>visit</span> <span class='op'>==</span> <span class='fl'>4</span><span class='op'>)</span>
<span class='va'>epilepsy4</span><span class='op'>$</span><span class='va'>Trt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>epilepsy4</span><span class='op'>$</span><span class='va'>Trt</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>epilepsy4</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/bar-epilepsy4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>And the box plots</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1417</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>epilepsy4</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Trt</span>, y <span class='op'>=</span> <span class='va'>count</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_boxplot.html'>geom_boxplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_jitter.html'>geom_jitter</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.05</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/jitter-epilepsy4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="model-and-priors-1">Model and Priors</h2>
<p>Model:</p>
<p><span class="math display">\[\begin{align}
  \text{count}_i &amp; \sim \mathrm{Pois}(\mu_i)  \\
  \log(\mu_i) &amp; = \eta_i \\
  \eta_i &amp; = \beta_0 + \beta_1 \text{Trt}_{i}
\end{align}\]</span></p>
<p>Priors:</p>
<p><span class="math display">\[\begin{align}
  \beta_0 &amp; \sim N(3, 2.5)  \\
  \beta_1 &amp; \sim N(0, 1)
\end{align}\]</span></p>
<p>Predicted seizure rate = <span class="math inline">\(\exp(\beta_0 +
\beta_1) = \exp(\beta_0) \exp(\beta_1)\)</span> for Trt = 1; <span
class="math inline">\(\exp(\beta_0)\)</span> for Trt = 0</p>
<p><span class="math inline">\(\beta_1\)</span> = mean difference in
<strong>log</strong> rate of seizure; <span
class="math inline">\(\exp(\beta_1)\)</span> = ratio in rate of
seizure</p>
<h2 id="mcmc-sampling-with-brms">MCMC Sampling With
<code>brms</code></h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>count</span> <span class='op'>~</span> <span class='va'>Trt</span>,
    data <span class='op'>=</span> <span class='va'>epilepsy4</span>,
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>,
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>
    <span class='op'>)</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>,
    seed <span class='op'>=</span> <span class='fl'>31143</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="interpretations">Interpretations</h2>
<p>Because of the nonlinear link function, one needs to be careful in
interpreting the coefficients. With the log link, it is common to obtain
the exponentiated coefficient. With the exponentiated coefficient, for
every unit difference in <span class="math inline">\(X\)</span>, the
predicted rate of seizure occurrence is <strong>multiplied</strong> by
<span class="math inline">\(\exp(\beta_1)\)</span> times. Here is the
usual step for obtaining the posterior distributions of the transformed
parameters:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m2_summary</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/draws-brms.html'>as_draws_array</a></span><span class='op'>(</span><span class='va'>m2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://mc-stan.org/posterior/reference/mutate_variables.html'>mutate_variables</a></span><span class='op'>(</span>exp_beta0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>b_Intercept</span><span class='op'>)</span>,
                     exp_beta1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>b_Trt1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://mc-stan.org/posterior/reference/draws_summary.html'>summarize_draws</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>So here is a paragraph for the example:</p>
<blockquote>
<p>The model predicts that the mean seizure rate in two weeks for the
control condition is 7.96, 90% CI [7.1, 8.84]; the exponentiated
coefficient for the treatment indicator is 0.85, 90% CI [0.72, 0.99],
meaning that on average, the treatment reduces seizure rate by 1.13% to
28.35%.</p>
</blockquote>
<h2 id="rootogram">Rootogram</h2>
<p>There is also a useful graphical tool, the rootogram, for diagnosing
count models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>m2</span>, type <span class='op'>=</span> <span class='st'>"rootogram"</span>, style <span class='op'>=</span> <span class='st'>"hanging"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m2-ppc-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>If the fit is good, the bars should be close to touching the
horizontal x-axis. Thus, the fit was not good in the above figure.
Models that accommodate overdispersion and excessive zeros may be
needed.</p>
<h2 id="negative-binomial-model">Negative Binomial Model</h2>
<p>The negative binomial distribution is usually used to handle
overdispersion in count data. The idea is that even with the same
predictor value, each individual has a different rate of occurrence for
an event, which is highly plausible for the epilepsy data. This class
will not get into the details of the negative binomial, but you can
check out <a
href="https://online.ucpress.edu/collabra/article/7/1/27242/118591/Poisson-Regressions-A-Little-Fishy">this
paper</a> or <a
href="https://www.wiley.com/en-us/An+Introduction+to+Categorical+Data+Analysis%2C+3rd+Edition-p-9781119405269">this
book</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m2_nb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>count</span> <span class='op'>~</span> <span class='va'>Trt</span>,
    data <span class='op'>=</span> <span class='va'>epilepsy4</span>,
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>negbinomial</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>,
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>
    <span class='op'>)</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>,
    seed <span class='op'>=</span> <span class='fl'>31143</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>m2_nb</span>, type <span class='op'>=</span> <span class='st'>"rootogram"</span>, style <span class='op'>=</span> <span class='st'>"hanging"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="glm_files/figure-html5/m2_nb-ppc-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We’ll continue with some other models in GLM later in the class. But
we’ll discuss regression with multiple predictors and causal thinking
first.</p>
<!-- The following chunk is only used in the website -->
<section id="last-updated" class="appendix layout-chunk"
data-layout="l-body">
<h2 class="appendix">Last updated</h2>
<div class="layout-chunk" data-layout="l-body">
<pre><code>#&gt; [1] &quot;March 21, 2022&quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="sourceCode" id="cb8"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
</section>
<div class="sourceCode" id="cb9"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Strictly speaking, GLM requires
distributions that are in the <em>exponential family</em>, which will
not include distributions like the <span
class="math inline">\(t\)</span> distribution, but here we will use GLM
also to include models that use distributions similar to those in the
exponential family, like the Student’s <span
class="math inline">\(t\)</span> distribution.<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/marklhc/20221-psyc573-usc/issues/new">create an issue</a> on the source repository.</p>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>. Source code is available at <a href="https://github.com/marklhc/20221-psyc573-usc">https://github.com/marklhc/20221-psyc573-usc</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2022 Hok Chio (Mark) Lai</p>
<p>Template by <a
href="https://github.com/distillpub/template/blob/master/AUTHORS">The
Distill Template Authors</a> and <a
href="https://www.rstudio.com">RStudio, Inc</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
