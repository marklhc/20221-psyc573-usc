<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>PSYC 573 Bayesian Data Analysis (2022 Spring): Causal Inference</title>


  <link rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-03-26"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-03-26"/>
  <meta name="article:author" content="Mark Lai"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="PSYC 573 Bayesian Data Analysis (2022 Spring): Causal Inference"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="PSYC 573 Bayesian Data Analysis (2022 Spring)"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="PSYC 573 Bayesian Data Analysis (2022 Spring): Causal Inference"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date"]}},"value":[{"type":"character","attributes":{},"value":["Causal Inference"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Mark Lai"]}]}]},{"type":"character","attributes":{},"value":["March 26, 2022"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */
  @import url('https://fonts.googleapis.com/css2?family=Ubuntu');


  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #990000;
    --header-color:    rgba(153, 27, 30, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    'Ubuntu', sans-serif;
    --mono-font:       monospace;
    --body-font:       'Ubuntu', sans-serif;
    --navbar-font:     'Source Sans Pro', sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #1F1C0F;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #1F1C0F;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */

  /* code block bg */

  d-article pre {
      overflow: auto !important;
  }

  d-article div.sourceCode pre {
      background-color: rgba(255, 204, 0, 0.05);
  	padding-top: 5px;
  	padding-bottom: 5px;
  	overflow: auto !important;
  }

  /* inline code bg */

  d-article p code,
  d-article aside code {
      background: rgba(0, 0, 0, 0.05);
  }</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
  <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="site_libs/clipboard-2.0.6/clipboard.min.js"></script>
  <link href="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
  <script src="site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
  <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clone fa-sm\" style=\"color: #301e64\"><\/i>","success":"<i class=\"fa fa-check fa-sm\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times fa-sm\" style=\"color: #F94144\"><\/i>"})</script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-225295148-2"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-225295148-2');
  </script>
  <style type="text/css">
  html {
    scroll-behavior: auto;
  }
  d-article {
      contain: none;
  }

  /* the value in left: will allow you to change the left edge gap */
  /* try using the value I have provided and check if the text goes beyond */
  /* the edge of the screen when you hover over using the mouse pointer */
  /* otherwise modify the values till you get a desirable result */

  @media screen and (min-width: 1000px) {
    #TOC {
      position: fixed;
      z-index: 50;
      left: 1.5em; /* changes the left edge gap */
      top: 6em; /* changes the top edge gap */
      max-width: 14%;
      overflow: auto;
    }
  }
  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="fixed_toc.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Causal Inference","authors":[{"author":"Mark Lai","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-03-26T00:00:00.000-07:00","citationText":"Lai, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">PSYC 573 Bayesian Data Analysis (2022 Spring)</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="syllabus.html">Syllabus</a>
<a href="modules.html">Modules</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Notes
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="r_markdown.html">R Markdown</a>
<a href="r_basics.html">R Basics</a>
<a href="probability.html">Probability</a>
<a href="bayes_rule.html">Bayes' Rule</a>
<a href="beta_Bernoulli_model.html">Beta-Bernoulli Model</a>
<a href="Poisson_model.html">(Bonus) Poisson Model</a>
<a href="mcmc.html">MCMC: Metropolis</a>
<a href="gibbs.html">MCMC: Gibbs</a>
<a href="hmc_stan.html">HMC and Stan</a>
<a href="hierarchical_models.html">Hierarchical Models</a>
<a href="group_comparisons.html">Group Comparisons</a>
<a href="glm.html">Generalized Linear Model I</a>
<a href="causal_inference.html">Causal Inference</a>
<a href="interaction.html">Interactions</a>
<a href="model_comparison.html">Model Comparison</a>
<a href="missing_data.html">Missing Data</a>
<a href="glm2.html">Bonus: Generalized Linear Model II</a>
</div>
</div>
<a href="https://github.com/marklhc/20221-psyc573-usc" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Causal Inference</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  
  Mark Lai
  
<br/>March 26, 2022
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#what-is-causal-inference">What is Causal
Inference?</a></li>
<li><a href="#directed-acyclic-graph-dag">Directed Acyclic Graph
(DAG)</a>
<ul>
<li><a href="#assumptions-in-a-dag">Assumptions in a DAG</a></li>
<li><a href="#basic-types-of-junctions">Basic Types of
Junctions</a></li>
<li><a href="#multiple-regression-model">Multiple Regression Model</a>
<ul>
<li><a href="#table">Table</a></li>
<li><a href="#posterior-predictive-checks">Posterior predictive
checks</a></li>
</ul></li>
<li><a href="#predicting-an-intervention">Predicting an
Intervention</a></li>
</ul></li>
<li><a href="#randomization">Randomization</a>
<ul>
<li><a href="#summary-statistics-tables">Summary Statistics
Tables</a></li>
<li><a
href="#randomization-removes-incoming-paths-for-treatment">Randomization
Removes Incoming Paths for Treatment</a></li>
<li><a
href="#the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data">The
Back-Door Criterion: Estimating Causal Effect in Nonexperimental
Data</a></li>
</ul></li>
<li><a href="#causal-chains">Causal Chains</a>
<ul>
<li><a href="#post-treatment-bias">Post-Treatment Bias</a></li>
<li><a href="#mediation">Mediation</a>
<ul>
<li><a href="#using-brms">Using <code>brms</code></a></li>
<li><a href="#using-stan">Using Stan</a></li>
<li><a href="#direct-and-indirect-effects">Direct and Indirect
Effects</a></li>
<li><a href="#sensitivity-analysis">Sensitivity analysis</a></li>
</ul></li>
</ul></li>
<li><a href="#collider">Collider</a></li>
<li><a href="#instrumental-variable">Instrumental Variable</a>
<ul>
<li><a href="#intention-to-treat-effect">Intention-To-Treat
Effect</a></li>
<li><a href="#complier-average-causal-eﬀect">Complier Average Causal
Eﬀect</a></li>
<li><a href="#last-updated">Last updated</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.dagitty.net'>dagitty</a></span><span class='op'>)</span>  <span class='co'># for drawing DAGs</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/malcolmbarrett/ggdag'>ggdag</a></span><span class='op'>)</span>  <span class='co'># render DAGs in ggplot style</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/rstan/'>rstan</a></span><span class='op'>)</span>
<span class='fu'><a href='https://mc-stan.org/rstan/reference/rstan_options.html'>rstan_options</a></span><span class='op'>(</span>auto_write <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>  <span class='co'># save compiled Stan object</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/paul-buerkner/brms'>brms</a></span><span class='op'>)</span>  <span class='co'># simplify fitting Stan GLM models</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/posterior/'>posterior</a></span><span class='op'>)</span>  <span class='co'># for summarizing draws</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/bayesplot/'>bayesplot</a></span><span class='op'>)</span>  <span class='co'># for plotting</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://vincentarelbundock.github.io/modelsummary/'>modelsummary</a></span><span class='op'>)</span>  <span class='co'># table for brms</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>theme_set</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid.major.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey92"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Causal inference is an important topic in statistics, but it also has
a complicated history with statistics. Early-day statisticians see
causality as a taboo such that researchers were discouraged from drawing
any causal conclusions in nonexperimental research. In the past few
decades, much progress has been made on causal inference in
epidemiology, computer science, and statistics, with several frameworks
proposed and many tools developed for experimental and nonexperimental
data. This note will introduce the causal diagram framework for encoding
causal assumptions, which can be used to guide analysis for drawing
causal conclusions. The goal is to give you some basic ideas so that you
can learn more from other sources, such as the book <a
href="http://bayes.cs.ucla.edu/BOOK-2K/"><em>Causality</em> by
Pearl</a>.</p>
<aside>
See this paper: <a href="https://doi.org/10.1177/1745691620921521"
class="uri">https://doi.org/10.1177/1745691620921521</a> for an argument
of how the taboo against causal inference has impeded the progress of
psychology research.
</aside>
<aside>
Another prominent framework for causal inference is the potential
outcome framework, which is thoroughly described in the book <a
href="https://doi.org/10.1017/CBO9781139025751"><em>Causal Inference for
Statistics, Social, and Biomedical Sciences: An Introduction</em> by
Imbens and Rubin</a>.
</aside>
<h1 id="what-is-causal-inference">What is Causal Inference?</h1>
<p>Causal inference is the process of determining the causal effect of
one variable on another, based on data and causal assumptions. Two
common ways of interpreting a causal effect are (a)
<em>intervention</em>: how <span class="math inline">\(Y\)</span> will
change if <span class="math inline">\(X\)</span> is manipulated to be
<span class="math inline">\(x\)</span>; (b) <em>counterfactual</em>:
what would <span class="math inline">\(Y\)</span> be if <span
class="math inline">\(X\)</span> were set to <span
class="math inline">\(x\)</span>.</p>
<h1 id="directed-acyclic-graph-dag">Directed Acyclic Graph (DAG)</h1>
<p>DAG is a tool for encoding causal assumptions. It contains nodes and
paths. A node is usually a variable that can be measured in the data or
unmeasured. Generally, paths in a DAG are directional (as implied by
<em>directed</em>), which indicates the directions of causal relations.
Acyclic means the causal chain does not close in a loop.</p>
<p>We can use an example described in McElreath (2020, chapter 5) about
data from 50 U.S. states from the 2009 American Community Survey
(ACS).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>waffle_divorce</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_delim</a></span><span class='op'>(</span>  <span class='co'># read delimited files</span>
    <span class='st'>"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/WaffleDivorce.csv"</span>,
    delim <span class='op'>=</span> <span class='st'>";"</span>
<span class='op'>)</span>
<span class='co'># Rescale Marriage and Divorce by dividing by 10</span>
<span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>Marriage</span> <span class='op'>&lt;-</span> <span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>Marriage</span> <span class='op'>/</span> <span class='fl'>10</span>
<span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>Divorce</span> <span class='op'>&lt;-</span> <span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>Divorce</span> <span class='op'>/</span> <span class='fl'>10</span>
<span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>MedianAgeMarriage</span> <span class='op'>&lt;-</span> <span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>MedianAgeMarriage</span> <span class='op'>/</span> <span class='fl'>10</span>
<span class='co'># See data description at https://rdrr.io/github/rmcelreath/rethinking/man/WaffleDivorce.html</span>
</code></pre>
</div>
</div>
<p>The outcome of interest is the divorce rate. The plot shows how
marriage rate is related to divorce rate at the state level.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>waffle_divorce</span>,
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Marriage</span>, y <span class='op'>=</span> <span class='va'>Divorce</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Marriage rate (per 10 adults)"</span>,
         y <span class='op'>=</span> <span class='st'>"Divorce rate (per 10 adults)"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>Loc</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/scatter-marriage-divorce-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>It looks like marriage rate can predict divorce rate. A causal
interpretation would be a stronger assertion, such that we expect to see
a higher divorce rate if policymakers encourage more people to get
married. In order to make a causal claim, we need to remove potential
confounders.</p>
<p>A potential confounder is when people get married. If people are
forced to get married later in life, fewer people in the population will
be married, and people may have less time, opportunity, and motivation
to get divorced (as it may be harder to find a new partner). Therefore,
we can use the following DAG:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span><span class='st'>"dag{ A -&gt; D; A -&gt; M; M -&gt; D }"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag1</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>M <span class='op'>=</span> <span class='fl'>0</span>, A <span class='op'>=</span> <span class='fl'>1</span>, D <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>M <span class='op'>=</span> <span class='fl'>0</span>, A <span class='op'>=</span> <span class='fl'>1</span>, D <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># Plot</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag1-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We can look at how the median age people get married in different
states relates to the divorce rate:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>waffle_divorce</span>,
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>MedianAgeMarriage</span>, y <span class='op'>=</span> <span class='va'>Divorce</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Median age marriage (10 years)"</span>,
         y <span class='op'>=</span> <span class='st'>"Divorce rate (per 10 adults)"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>Loc</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/scatter-age-divorce-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="assumptions-in-a-dag">Assumptions in a DAG</h2>
<p>In a graphical model, there are usually two kinds of assumptions
conveyed. Perhaps counterintuitively, the weaker assumptions are the
ones you can see, whereas the stronger assumptions are ones you
<strong>do not see</strong>.</p>
<p>For example, a weak assumption is: - Marriage age <em>may</em>
directly influence the number of people who are married</p>
<p>On the other hand, examples of a strong assumption are: - Marriage
rate does not directly influence the age people get married - there is
no other variable in the causal pathway M → D</p>
<p>The last assumption will not hold if there is a common cause of M and
D other than A.</p>
<h2 id="basic-types-of-junctions">Basic Types of Junctions</h2>
<ul>
<li>Fork: A ← B → C
<ul>
<li>A and C are correlated due to a common cause B</li>
</ul></li>
<li>Chain/Pipe: A → B → C
<ul>
<li>B is on the causal pathway of A to C</li>
</ul></li>
<li>Collider: A → B ← C
<ul>
<li>B is a <em>descendant</em> of both A and C</li>
</ul></li>
</ul>
<p>Going back to our example, there is a fork relation: M → <span
style="color:red">A</span> → D. In this case, A is a confounder when
estimating the causal relation between M and D. In this case, the causal
effect of M to D can be obtained by adjusting for A, which means looking
at the subsets of data where A is constant. In regression, adjustment is
obtained by including both M and A as predictors of D.</p>
<h2 id="multiple-regression-model">Multiple Regression Model</h2>
<p><span class="math display">\[
  \begin{aligned}
    D_i &amp; \sim N(\mu_i, \sigma)  \\
    \mu_i &amp; = \beta_0 + \beta_1 A_i + \beta_2 M_i \\
    \beta_0 &amp; \sim N(0, 1) \\
    \beta_1 &amp; \sim N(0, 1) \\
    \beta_2 &amp; \sim N(0, 1) \\
  \end{aligned}
\]</span></p>
<p>Assuming a correctly specified DAG, <span
class="math inline">\(\beta_2\)</span> is the causal effect of M on D.
Here is the Stan code:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb1"><pre
class="sourceCode stan"><code class="sourceCode stan"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;  <span class="co">// number of observations</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; p;  <span class="co">// number of predictors</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;  <span class="co">// outcome;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N, p] x;  <span class="co">// predictor matrix;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta0;  <span class="co">// regression intercept</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[p] beta;  <span class="co">// regression coefficients</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;  <span class="co">// SD of prediction error</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// model</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  y ~ normal_id_glm(x, beta0, beta, sigma);</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prior</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  beta0 ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  beta ~ std_normal();</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  sigma ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y_rep;  <span class="co">// place holder</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    y_rep[n] = normal_rng(beta0 + dot_product(beta, x[n]), sigma);</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m1_stan</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"stan"</span>, <span class='st'>"multiple_reg.stan"</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
        N <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>waffle_divorce</span><span class='op'>)</span>,
        p <span class='op'>=</span> <span class='fl'>2</span>,
        y <span class='op'>=</span> <span class='va'>waffle_divorce</span><span class='op'>$</span><span class='va'>Divorce</span>,
        x <span class='op'>=</span> <span class='va'>waffle_divorce</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MedianAgeMarriage"</span>, <span class='st'>"Marriage"</span><span class='op'>)</span><span class='op'>]</span>
    <span class='op'>)</span>,
    seed <span class='op'>=</span> <span class='fl'>941</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>And using <code>brms</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>Divorce</span> <span class='op'>~</span> <span class='va'>MedianAgeMarriage</span> <span class='op'>+</span> <span class='va'>Marriage</span>,
          data <span class='op'>=</span> <span class='va'>waffle_divorce</span>,
          prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>std_normal</span><span class='op'>(</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span> <span class='op'>+</span>
              <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span> <span class='op'>+</span>
              <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>,
          seed <span class='op'>=</span> <span class='fl'>941</span>,
          iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="table">Table</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/msummary.html'>msummary</a></span><span class='op'>(</span><span class='va'>m1</span>,
         estimate <span class='op'>=</span> <span class='st'>"{estimate} [{conf.low}, {conf.high}]"</span>,
         statistic <span class='op'>=</span> <span class='cn'>NULL</span>, fmt <span class='op'>=</span> <span class='fl'>2</span>
<span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:center;">
3.50 [2.00, 5.02]
</td>
</tr>
<tr>
<td style="text-align:left;">
b_MedianAgeMarriage
</td>
<td style="text-align:center;">
−0.94 [−1.41, −0.43]
</td>
</tr>
<tr>
<td style="text-align:left;">
b_Marriage
</td>
<td style="text-align:center;">
−0.04 [−0.21, 0.12]
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
sigma
</td>
<td style="text-align:center;box-shadow: 0px 1px">
0.15 [0.12, 0.19]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD
</td>
<td style="text-align:center;">
20.9
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD s.e.
</td>
<td style="text-align:center;">
6.5
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC
</td>
<td style="text-align:center;">
−41.8
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC s.e.
</td>
<td style="text-align:center;">
12.9
</td>
</tr>
<tr>
<td style="text-align:left;">
WAIC
</td>
<td style="text-align:center;">
−42.1
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:center;">
0.14
</td>
</tr>
</tbody>
</table>
</div>
<p>As shown in the table, when holding constant the median marriage age
of states, marriage rate has only a small effect on divorce rate.</p>
<h3 id="posterior-predictive-checks">Posterior predictive checks</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>m1</span>, ndraws <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span> <span class='co'># density</span>
</code></pre>
</div>
<img src="causal_inference_files/figure-html5/pp-check-m1-1.png" width="70%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>m1</span>, type <span class='op'>=</span> <span class='st'>"intervals"</span>, x <span class='op'>=</span> <span class='st'>"Marriage"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Marriage"</span>, y <span class='op'>=</span> <span class='st'>"Divorce"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="causal_inference_files/figure-html5/pp-check-m1-2.png" width="70%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/brms/man/pp_check.brmsfit.html'>pp_check</a></span><span class='op'>(</span><span class='va'>m1</span>, type <span class='op'>=</span> <span class='st'>"intervals"</span>, x <span class='op'>=</span> <span class='st'>"MedianAgeMarriage"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"MedianAgeMarriage"</span>, y <span class='op'>=</span> <span class='st'>"Divorce"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/pp-check-m1-3.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>The model does not fit every state (e.g., UT, ME, ID).</p>
<h2 id="predicting-an-intervention">Predicting an Intervention</h2>
<p>If the causal assumption in our DAG is reasonable, we have obtained
an estimate of the causal effect of marriage rate on divorce rate at the
state level. This allows us to answer questions like</p>
<blockquote>
<p>What would happen to the divorce rate if we encourage more people to
get married (so the marriage rate increases by 10 percentage
points)?</p>
</blockquote>
<p>We can use the Bayesian model, which is generative, to make such
predictions. Consider a state with a marriage rate of 2 (per 10 adults).
The predicted divorce rate is</p>
<p><span class="math display">\[\beta_0 + \beta_1 A + \beta_2
(2)\]</span></p>
<p>Consider an intervention that makes the marriage rate increase from 2
to 3. The predicted divorce rate will be</p>
<p><span class="math display">\[\beta_0 + \beta_1 A + \beta_2
(3)\]</span></p>
<p>The change in divorce rate is</p>
<p><span class="math display">\[\beta_0 + \beta_1 A + \beta_2 (3) -
\beta_0 + \beta_1 A + \beta_2 (2) = \beta_2\]</span></p>
<p>Here is what the model would predict in terms of the change in the
divorce rate (holding median marriage age to 25 years old), using R:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    Marriage <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>,
    MedianAgeMarriage <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2.5</span>, <span class='fl'>2.5</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>pred_df</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_cols</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>m1</span>, newdata <span class='op'>=</span> <span class='va'>pred_df</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<thead>
<tr>
<th style="text-align:right;">
Marriage
</th>
<th style="text-align:right;">
MedianAgeMarriage
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
1.067812
</td>
<td style="text-align:right;">
0.0344112
</td>
<td style="text-align:right;">
0.99942
</td>
<td style="text-align:right;">
1.135665
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
1.025805
</td>
<td style="text-align:right;">
0.0681869
</td>
<td style="text-align:right;">
0.89369
</td>
<td style="text-align:right;">
1.159737
</td>
</tr>
</tbody>
</table>
</div>
<p>The difference should be just the estimate of <span
class="math inline">\(\beta_2\)</span>, which has the following
posterior distribution:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-distributions.html'>mcmc_dens</a></span><span class='op'>(</span><span class='va'>m1</span>, pars <span class='op'>=</span> <span class='st'>"b_Marriage"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/plot-post-beta2-m1-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h1 id="randomization">Randomization</h1>
<p>We’ll use the <code>framing</code> data set from the
<code>mediation</code> package, so you’ll need to have the package
installed first. The data were analyzed in a <a
href="https://doi.org/10.1111/j.1540-5907.2008.00353.x">report in the
American Journal of Political Science</a>. The study examined whether
“news about the costs of immigration boosts white opposition”
(p. 959).</p>
<h2 id="summary-statistics-tables">Summary Statistics Tables</h2>
<p>I’ll take a quick detour to introduce you to some useful functions
for tabulating your data. The functions will be from the
<code>modelsummary</code> package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>framing</span>, package <span class='op'>=</span> <span class='st'>"mediation"</span><span class='op'>)</span>
<span class='co'># Subtract the `emo` variable by 3 so that it starts from 0-9</span>
<span class='va'>framing</span><span class='op'>$</span><span class='va'>emo</span> <span class='op'>&lt;-</span> <span class='va'>framing</span><span class='op'>$</span><span class='va'>emo</span> <span class='op'>-</span> <span class='fl'>3</span>
<span class='co'># Quick summary of selected variables</span>
<span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/datasummary_skim.html'>datasummary_skim</a></span><span class='op'>(</span><span class='va'>framing</span><span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Unique (#)
</th>
<th style="text-align:right;">
Missing (%)
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
SD
</th>
<th style="text-align:right;">
Min
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
Max
</th>
<th style="text-align:right;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
47.8
</td>
<td style="text-align:right;">
16.0
</td>
<td style="text-align:right;">
18.0
</td>
<td style="text-align:right;">
47.0
</td>
<td style="text-align:right;">
85.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="-0.21" y="10.25" width="3.32" height="1.41" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="3.10" y="8.85" width="3.32" height="2.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.42" y="4.39" width="3.32" height="7.27" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.74" y="6.27" width="3.32" height="5.40" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.05" y="6.97" width="3.32" height="4.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.37" y="3.22" width="3.32" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.69" y="6.50" width="3.32" height="5.16" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="23.00" y="5.80" width="3.32" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="26.32" y="6.03" width="3.32" height="5.63" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="29.64" y="5.80" width="3.32" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.96" y="6.97" width="3.32" height="4.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.27" y="8.85" width="3.32" height="2.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="39.59" y="11.19" width="3.32" height="0.47" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.91" y="10.02" width="3.32" height="1.64" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.8
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
11.0
</td>
<td style="text-align:right;">
19.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="-0.69" y="10.47" width="4.94" height="1.19" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.25" y="10.21" width="4.94" height="1.45" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="9.16" width="4.94" height="2.51" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="14.12" y="7.97" width="4.94" height="3.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.06" y="6.25" width="4.94" height="5.41" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="3.22" width="4.94" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.94" y="5.46" width="4.94" height="6.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="33.88" y="7.57" width="4.94" height="4.09" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="10.08" width="4.94" height="1.58" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="43.75" y="11.27" width="4.94" height="0.40" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
emo
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.0
</td>
<td style="text-align:right;">
2.8
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
4.0
</td>
<td style="text-align:right;">
9.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.94" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.72" y="6.42" width="4.94" height="5.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="11.65" y="7.44" width="4.94" height="4.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="6.42" width="4.94" height="5.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="21.53" y="7.88" width="4.94" height="3.79" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="26.47" y="8.46" width="4.94" height="3.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="8.60" width="4.94" height="3.06" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.35" y="9.48" width="4.94" height="2.18" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.28" y="8.46" width="4.94" height="3.20" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
p_harm
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
6.0
</td>
<td style="text-align:right;">
8.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="10.71" width="3.70" height="0.95" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="5.48" y="9.16" width="3.70" height="2.50" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="12.89" y="6.90" width="3.70" height="4.76" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="20.30" y="8.09" width="3.70" height="3.57" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.70" y="4.29" width="3.70" height="7.37" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="35.11" y="7.74" width="3.70" height="3.92" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="11.66" width="3.70" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.52" y="3.22" width="3.70" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
tone
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.53" width="4.44" height="8.13" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
eth
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.53" width="4.44" height="8.13" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
treat
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="8.75" width="4.44" height="2.91" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
immigr
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
4.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="10.18" width="7.41" height="1.49" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.19" y="6.74" width="7.41" height="4.93" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.59" y="11.66" width="7.41" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="5.80" width="7.41" height="5.86" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.41" y="11.66" width="7.41" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.81" y="3.22" width="7.41" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
anti_info
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="10.62" width="4.44" height="1.04" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
<tr>
<td style="text-align:left;">
cong_mesg
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewBox="0 0 48.00 12.00">
<defs>
<style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style>
</defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clipPath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clipPath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clipPath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="4.44" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.22" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.67" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.11" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.56" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.44" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.89" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.33" y="11.66" width="4.44" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.78" y="7.46" width="4.44" height="4.20" style="stroke-width: 0.38; fill: #000000;"></rect></g>
</svg>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Summary by treatment condition (`tone`)</span>
<span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/datasummary_balance.html'>datasummary_balance</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>tone</span>, data <span class='op'>=</span> <span class='va'>framing</span><span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
0
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
1
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="2">
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Std. Dev.
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Std. Dev.
</th>
<th style="text-align:right;">
Diff. in Means
</th>
<th style="text-align:right;">
Std. Error
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
48.4
</td>
<td style="text-align:right;">
16.0
</td>
<td style="text-align:right;">
47.1
</td>
<td style="text-align:right;">
16.0
</td>
<td style="text-align:right;">
-1.3
</td>
<td style="text-align:right;">
2.0
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
11.0
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
10.6
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
-0.4
</td>
<td style="text-align:right;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
emo
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
2.8
</td>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
0.3
</td>
</tr>
<tr>
<td style="text-align:left;">
p_harm
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
5.5
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
0.2
</td>
</tr>
<tr>
<td style="text-align:left;">
eth
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.5
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
immigr
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
2.8
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:left;">
anti_info
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
cong_mesg
</td>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.3
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.5
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.4
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.5
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.0
</td>
<td style="text-align:right;box-shadow: 0px 1px">
0.1
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:right;">
N
</td>
<td style="text-align:right;">
Pct.
</td>
<td style="text-align:right;">
N
</td>
<td style="text-align:right;">
Pct.
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
cond
</td>
<td style="text-align:left;">
not asked
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
refused
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
control
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
50.4
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
49.6
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
51.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
48.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
anx
</td>
<td style="text-align:left;">
not asked
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
refused
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
very anxious
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
26.2
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
19.3
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
somewhat anxious
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
36.9
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
a little anxious
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
23.8
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
31.9
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
not anxious at all
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
13.1
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
20.7
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
educ
</td>
<td style="text-align:left;">
not asked
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
refused
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
less than high school
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
high school
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
36.9
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
32.6
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
some college
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
23.8
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
28.9
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
bachelor’s degree or higher
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
34.6
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
gender
</td>
<td style="text-align:left;">
not asked
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
refused
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
49.2
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
45.9
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
50.8
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
54.1
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
english
</td>
<td style="text-align:left;">
Strongly Favor
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4.4
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Favor
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Oppose
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
33.8
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Strongly Oppose
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
53.8
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
60.0
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># More tailor-made table with selected variables by treatment condition</span>
<span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/datasummary.html'>datasummary</a></span><span class='op'>(</span><span class='va'>emo</span> <span class='op'>+</span> <span class='va'>p_harm</span> <span class='op'>+</span> <span class='va'>cong_mesg</span> <span class='op'>~</span> <span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/Factor.html'>Factor</a></span><span class='op'>(</span><span class='va'>tone</span><span class='op'>)</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>Mean</span> <span class='op'>+</span> <span class='va'>SD</span> <span class='op'>+</span> <span class='va'>Histogram</span><span class='op'>)</span>,
            data <span class='op'>=</span> <span class='va'>framing</span><span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
0
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
1
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
SD
</th>
<th style="text-align:right;">
Histogram
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
SD
</th>
<th style="text-align:right;">
Histogram
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
emo
</td>
<td style="text-align:right;">
3.39
</td>
<td style="text-align:right;">
2.63
</td>
<td style="text-align:right;">
▇▅▇▆▆▃▃▂▂▂
</td>
<td style="text-align:right;">
4.53
</td>
<td style="text-align:right;">
2.81
</td>
<td style="text-align:right;">
▆▄▆▅▇▇▅▆▄▆
</td>
</tr>
<tr>
<td style="text-align:left;">
p_harm
</td>
<td style="text-align:right;">
5.53
</td>
<td style="text-align:right;">
1.77
</td>
<td style="text-align:right;">
▁▃▅▄▇▂▆
</td>
<td style="text-align:right;">
6.23
</td>
<td style="text-align:right;">
1.69
</td>
<td style="text-align:right;">
▁▃▂▅▄▇
</td>
</tr>
<tr>
<td style="text-align:left;">
cong_mesg
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
▇▃
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
▇▄
</td>
</tr>
</tbody>
</table>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Correlation table</span>
<span class='va'>framing</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>tone</span>, <span class='va'>emo</span>, <span class='va'>cong_mesg</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/datasummary_correlation.html'>datasummary_correlation</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"pearson"</span><span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
tone
</th>
<th style="text-align:right;">
emo
</th>
<th style="text-align:right;">
cong_mesg
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
tone
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
.
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
emo
</td>
<td style="text-align:right;">
.21
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
.
</td>
</tr>
<tr>
<td style="text-align:left;">
cong_mesg
</td>
<td style="text-align:right;">
.05
</td>
<td style="text-align:right;">
.37
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<h2
id="randomization-removes-incoming-paths-for-treatment">Randomization
Removes Incoming Paths for Treatment</h2>
<p>Let’s consider a DAG without randomization, for the following two
variables:</p>
<ul>
<li>X: exposure to a negatively framed news story about immigrants</li>
<li>Y: anti-immigration political action</li>
</ul>
<p>There are many possible confounders when we observe these two
variables in data (e.g., the political affiliation of an individual, the
state a person resides). We can represent these unobserved confounders
as U, so the DAG will be something like</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      X -&gt; Y; U -&gt; X; U -&gt; Y
      U [unobserved]
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># Plot</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag2-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>The magic of randomization—randomly assigning individuals to a
manipulated level of X—is that it blocks the path U → X. Therefore, with
randomization, the reason a person sees a negatively-framed news story
about immigrants is not related to reasons that the person may have
intentions for anti-immigration actions. The DAG becomes</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      X -&gt; Y; U -&gt; Y
      U [unobserved]
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag3</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># Plot</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag3</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag3-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>Therefore, when randomization is successful, the path coefficient of
X → Y is the causal effect of X on Y. However, randomized experiments do
not always rule out all confounding. For example, if participants are
randomly assigned to different experimental conditions, but those who
disagree with the presented news story dropped out, such attrition can
induce a non-zero correlation in the remaining sample between X and
Y.</p>
<h2
id="the-back-door-criterion-estimating-causal-effect-in-nonexperimental-data">The
Back-Door Criterion: Estimating Causal Effect in Nonexperimental
Data</h2>
<p>Randomization is one—but not the only—way to rule out confounding
variables. Much progress has been made in clarifying that causal effects
<strong>can</strong> be estimated in nonexperimental data. After all,
researchers have not randomly assigned individuals to smoke <span
class="math inline">\(x\)</span> cigarettes per day, but we are
confident that smoking causes cancer; we never manipulated the moon’s
gravitational force, but we are pretty sure that the moon is a cause of
high and low tides.</p>
<p>In a DAG, the back-door criterion can be used to identify variables
that we should adjust for to obtain a causal effect. The set of
variables to be adjusted should (a) blocks every path between X and Y
that contains an arrow entering X and (b) does not contain variables
that are descendant of X.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      X -&gt; Y; W1 -&gt; X; U -&gt; W2; W2 -&gt; X; W1 -&gt; Y; U -&gt; Y
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/VariableStatus.html'>latents</a></span><span class='op'>(</span><span class='va'>dag4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"U"</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, W1 <span class='op'>=</span> <span class='fl'>0.66</span>, U <span class='op'>=</span> <span class='fl'>1.32</span>, W2 <span class='op'>=</span> <span class='fl'>0.66</span>, Y <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, W1 <span class='op'>=</span> <span class='fl'>1</span>, U <span class='op'>=</span> <span class='fl'>1</span>, W2 <span class='op'>=</span> <span class='fl'>0.5</span>, Y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag4</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We can use a function in the <code>daggity</code> package to identify
the set of variables that satisfy the back-door criterion. In this case,
we say that X and Y are <span class="math inline">\(d\)</span>-separated
by this set of adjusted variables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/adjustmentSets.html'>adjustmentSets</a></span><span class='op'>(</span><span class='va'>dag4</span>, exposure <span class='op'>=</span> <span class='st'>"X"</span>, outcome <span class='op'>=</span> <span class='st'>"Y"</span>,
               effect <span class='op'>=</span> <span class='st'>"direct"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>#&gt; { W1, W2 }</code></pre>
</div>
<h1 id="causal-chains">Causal Chains</h1>
<h2 id="post-treatment-bias">Post-Treatment Bias</h2>
<p>Here are some key variables from the <code>framing</code> data
set:</p>
<ul>
<li><code>cong_mesg</code>: binary variable indicating whether or not
the participant agreed to send a letter about immigration policy to his
or her member of Congress</li>
<li><code>emo</code>: posttest anxiety about increased immigration
(0-9)</li>
<li><code>tone</code>: framing of news story (0 = positive, 1 =
negative)</li>
</ul>
<p>We can compare the results of two models:</p>
<ol type="1">
<li><code>tone</code> → <code>cong_mesg</code></li>
<li><code>tone</code> → <code>cong_mesg</code>, adjusting for
<code>emo</code></li>
</ol>
<p>Which model gives us the causal effect estimate for
<code>tone</code>? Let’s run the two models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_no_adjust</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>cong_mesg</span> <span class='op'>~</span> <span class='va'>tone</span>,
                   data <span class='op'>=</span> <span class='va'>framing</span>,
                   family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>bernoulli</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m_adjust</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>cong_mesg</span> <span class='op'>~</span> <span class='va'>tone</span> <span class='op'>+</span> <span class='va'>emo</span>,
                data <span class='op'>=</span> <span class='va'>framing</span>,
                family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>bernoulli</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We can combine the results in a table:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://vincentarelbundock.github.io/modelsummary/reference/msummary.html'>msummary</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>`No adjustment` <span class='op'>=</span> <span class='va'>m_no_adjust</span>,
              `Adjusting for feeling` <span class='op'>=</span> <span class='va'>m_adjust</span><span class='op'>)</span>,
         estimate <span class='op'>=</span> <span class='st'>"{estimate} [{conf.low}, {conf.high}]"</span>,
         statistic <span class='op'>=</span> <span class='cn'>NULL</span>, fmt <span class='op'>=</span> <span class='fl'>2</span>
<span class='op'>)</span>
</code></pre>
</div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
No adjustment
</th>
<th style="text-align:center;">
Adjusting for feeling
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
b_Intercept
</td>
<td style="text-align:center;">
−0.82 [−1.17, −0.43]
</td>
<td style="text-align:center;">
−2.00 [−2.62, −1.46]
</td>
</tr>
<tr>
<td style="text-align:left;">
b_tone
</td>
<td style="text-align:center;">
0.22 [−0.28, 0.71]
</td>
<td style="text-align:center;">
−0.14 [−0.68, 0.42]
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
b_emo
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
0.32 [0.22, 0.43]
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
265
</td>
<td style="text-align:center;">
265
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD
</td>
<td style="text-align:center;">
−170.1
</td>
<td style="text-align:center;">
−152.4
</td>
</tr>
<tr>
<td style="text-align:left;">
ELPD s.e.
</td>
<td style="text-align:center;">
5.5
</td>
<td style="text-align:center;">
7.4
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC
</td>
<td style="text-align:center;">
340.2
</td>
<td style="text-align:center;">
304.8
</td>
</tr>
<tr>
<td style="text-align:left;">
LOOIC s.e.
</td>
<td style="text-align:center;">
11.0
</td>
<td style="text-align:center;">
14.8
</td>
</tr>
<tr>
<td style="text-align:left;">
WAIC
</td>
<td style="text-align:center;">
340.2
</td>
<td style="text-align:center;">
304.8
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:center;">
0.47
</td>
<td style="text-align:center;">
0.44
</td>
</tr>
</tbody>
</table>
</div>
<p>We can see that the Bayes estimate of the coefficient for
<code>tone</code> was positive without <code>emo</code>, but was
negative with <code>emo</code>. Which one should we believe? The
information criteria (LOOIC and WAIC) suggested that the model with
<code>emo</code> was better for prediction, but just because something
helps predict the outcome doesn’t make it a causal variable. To
repeat,</p>
<blockquote>
<p>Coefficients in a predictive model are not causal effects.</p>
</blockquote>
<p>And to emphasize again,</p>
<blockquote>
<p>Causal inference requires causal assumptions, and these assumptions
are not in the data.</p>
</blockquote>
<p>So instead, we need a DAG. Given that we know <code>emo</code> is
measured <strong>after</strong> the intervention, it seems reasonable to
think that a negatively-framed story about immigrants would elicit some
negative emotions about increased immigration, and that emotion may
prompt people to take anti-immigrant actions. Therefore, we have the
following DAG:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      T -&gt; C; T -&gt; E; E -&gt; C
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag5</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>T <span class='op'>=</span> <span class='fl'>0</span>, E <span class='op'>=</span> <span class='fl'>1</span>, C <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>T <span class='op'>=</span> <span class='fl'>0</span>, E <span class='op'>=</span> <span class='fl'>1</span>, C <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># Plot</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag5</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag5-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>This is an example of a pipe/chain. It is a causal chain going from
T(one) → E(motion) → C(ongress message). If we are interested in the
causal effect of T, we should not condition on E; conditioning on E
would mean comparing those who saw the negatively-framed story and
<em>those who saw the positively-framed story but had the same negative
emotion towards immigrants.</em> In other words, adjusting for E would
mean taking out part of the effect of T on C through E.</p>
<p>As another example, think about a drug that is supposed to lower the
risk of a heart attack. Imagine someone conducting a study comparing
drug/no drug conditions on their probability of getting heart attacks.
Should we adjust for participants’ blood pressure after the
intervention? If we want to know the drug’s effect, and that the drug
works by lowering blood pressure, we should not adjust for posttest
blood pressure. Otherwise, we would be asking the question: does the
drug help prevent heart attacks through something other than lowering
one’s blood pressure?</p>
<p>The latter question can be answered in mediation analysis.</p>
<h2 id="mediation">Mediation</h2>
<p>In the DAG above, E is a post-treatment variable potentially
influenced by T, which we call a <strong>mediator</strong>. Mediator is
an important topic in causal inference, as it informs the mechanism of
how a variable has a causal effect on an outcome.</p>
<p>One thing to be careful is that statistically speaking, a mediator
behaves very much like a confounder, and their difference is based on
causal assumptions.</p>
<p>Let’s analyze the mediation model in Figure X. There are two
variables that are on the receiving end of some causal effects:
<code>emo</code> and <code>cong_mesg</code>. Whereas GLM handles one
outcome, with <code>brms</code>, we can have a system of equations—one
for each outcome—estimated simultaneously, as shown in the code
below.</p>
<h3 id="using-brms">Using <code>brms</code></h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>prior_m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>
<span class='va'>m_med</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span>
    <span class='co'># Two equations for two outcomes</span>
    <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>cong_mesg</span> <span class='op'>~</span> <span class='va'>tone</span> <span class='op'>+</span> <span class='va'>emo</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>emo</span> <span class='op'>~</span> <span class='va'>tone</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula-helpers.html'>set_rescor</a></span><span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span>,
    <span class='co'># A list of two family arguments for two outcomes</span>
    family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsfamily.html'>bernoulli</a></span><span class='op'>(</span><span class='st'>"logit"</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span><span class='st'>"identity"</span><span class='op'>)</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='va'>framing</span>,
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span>, resp <span class='op'>=</span> <span class='st'>"emo"</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span>, resp <span class='op'>=</span> <span class='st'>"emo"</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>2.5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span>, resp <span class='op'>=</span> <span class='st'>"congmesg"</span><span class='op'>)</span>,
    seed <span class='op'>=</span> <span class='fl'>1338</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="using-stan">Using Stan</h3>
<p>Here’s some Stan code for running the same mediation model</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb3"><pre
class="sourceCode stan"><code class="sourceCode stan"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N0;  <span class="co">// number of observations (control)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N1;  <span class="co">// number of observations (treatment)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y0[N0];  <span class="co">// outcome (control);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y1[N1];  <span class="co">// outcome (treatment);</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N0] m0;  <span class="co">// mediator (control);</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N1] m1;  <span class="co">// mediator (treatment);</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpham;  <span class="co">// regression intercept for M</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alphay;  <span class="co">// regression intercept for M</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta1;   <span class="co">// X -&gt; M</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta2;   <span class="co">// X -&gt; Y</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta3;   <span class="co">// M -&gt; Y</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigmam;  <span class="co">// SD of prediction error for M</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// model</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  m0 ~ normal(alpham, sigmam);</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  m1 ~ normal(alpham + beta1, sigmam);</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  y0 ~ bernoulli_logit(alphay + beta3 * m0);</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  y1 ~ bernoulli_logit(alphay + beta2 + beta3 * m1);</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prior</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  alpham ~ normal(<span class="fl">4.5</span>, <span class="fl">4.5</span>);</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  alphay ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  beta1 ~ std_normal();</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  beta2 ~ std_normal();</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  beta3 ~ std_normal();</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  sigmam ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 1. form the data list for Stan</span>
<span class='va'>stan_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>framing</span>,
                 <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>N0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span>,
                      N1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>,
                      m0 <span class='op'>=</span> <span class='va'>emo</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>]</span>,
                      m1 <span class='op'>=</span> <span class='va'>emo</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span>,
                      y0 <span class='op'>=</span> <span class='va'>cong_mesg</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>]</span>,
                      y1 <span class='op'>=</span> <span class='va'>cong_mesg</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># 2. Run Stan</span>
<span class='va'>m_med_stan</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></span><span class='op'>(</span>
    file <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"stan"</span>, <span class='st'>"mediation_logit_normal.stan"</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='va'>stan_dat</span>,
    seed <span class='op'>=</span> <span class='fl'>1338</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="direct-and-indirect-effects">Direct and Indirect Effects</h3>
<p>In a mediation model, the effect of X on Y has two mechanisms: -
Indirect effect: X causes Y because X causes M, and M causes Y - Direct
effect: X causes Y without involving M</p>
<p>More specifically, the direct effect is the change in Y for one unit
change in X, <em>holding M constant</em>. In our example, it means
comparing subsets of the treatment and the control groups, under the
condition that both subsets have the same level of negative emotion
about increased immigration. The indirect effect takes a bit more effort
to understand: it is the change in Y for the control group (or the
treatment group), if their mediator value is set to the level as the
treatment group. In our example, it would mean comparing the control
group and the <em>counterfactual</em> where the control group had their
negative emotion changed to the same level as the treatment group.</p>
<p>The <em>causal mediation</em> literature has some more distinctions
on the different types of direct and indirect effects. Below I give
codes for obtaining these effects without going into details.</p>
<aside>
You can find more information about causal mediation in this paper: <a
href="https://ftp.cs.ucla.edu/pub/stat_ser/r389.pdf"
class="uri">https://ftp.cs.ucla.edu/pub/stat_ser/r389.pdf</a>
</aside>
<h4 id="controlled-direct-effect-cde">Controlled direct effect
(CDE)</h4>
<p>CDE is the direct effect when the mediator is set to a specific
level. Below shows the CDE for <code>emo</code> = 0 and <code>emo</code>
= 9, respectively.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cond_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>tone <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
                      emo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>9</span>, <span class='fl'>9</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>cond_df</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_cols</a></span><span class='op'>(</span>
        <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>m_med</span>, newdata <span class='op'>=</span> <span class='va'>cond_df</span><span class='op'>)</span><span class='op'>[</span> , , <span class='st'>"congmesg"</span><span class='op'>]</span>
    <span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<thead>
<tr>
<th style="text-align:right;">
tone
</th>
<th style="text-align:right;">
emo
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Est.Error
</th>
<th style="text-align:right;">
Q2.5
</th>
<th style="text-align:right;">
Q97.5
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.1223752
</td>
<td style="text-align:right;">
0.0324562
</td>
<td style="text-align:right;">
0.0683844
</td>
<td style="text-align:right;">
0.1939118
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.1093674
</td>
<td style="text-align:right;">
0.0334159
</td>
<td style="text-align:right;">
0.0550752
</td>
<td style="text-align:right;">
0.1854280
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.6961890
</td>
<td style="text-align:right;">
0.0713012
</td>
<td style="text-align:right;">
0.5462604
</td>
<td style="text-align:right;">
0.8218189
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.6680737
</td>
<td style="text-align:right;">
0.0634371
</td>
<td style="text-align:right;">
0.5351279
</td>
<td style="text-align:right;">
0.7848791
</td>
</tr>
</tbody>
</table>
</div>
<h4 id="natural-direct-effect-nde">Natural direct effect (NDE)</h4>
<p>The “natural” effects are quantities for some kind of population
averages. NDE is the direct effect when the mediator is held constant at
the level of the control group. Below we simulate some data to obtain
the level of <code>emo</code> that would be “naturally” obtained for the
<code>tone</code> = 0 group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1235</span><span class='op'>)</span>
<span class='co'># Obtain posterior draws of parameters</span>
<span class='va'>post_draws</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>m_med</span><span class='op'>)</span>
<span class='co'># Simulated emo with tone = 0</span>
<span class='va'>sim_emo0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_emo_Intercept</span>,
                  mean <span class='op'>=</span> <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_emo_Intercept</span>,
                  sd <span class='op'>=</span> <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>sigma_emo</span><span class='op'>)</span>
<span class='co'># Predicted cong_mesg for tone = 0, emo = sim_emo0</span>
<span class='va'>pred_congmesg0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span> <span class='co'># apply the inverse probit link</span>
    <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_Intercept</span> <span class='op'>+</span>
        <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_emo</span> <span class='op'>*</span> <span class='va'>sim_emo0</span>
<span class='op'>)</span>
<span class='co'># Predicted cong_mesg for tone = 1, emo = sim_emo0</span>
<span class='va'>pred_congmesg1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span> <span class='co'># apply the inverse probit link</span>
    <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_Intercept</span> <span class='op'>+</span>
        <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_tone</span> <span class='op'>+</span>
        <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_emo</span> <span class='op'>*</span> <span class='va'>sim_emo0</span>
<span class='op'>)</span>
<span class='co'># Natural direct effect</span>
<span class='va'>nde</span> <span class='op'>&lt;-</span> <span class='va'>pred_congmesg1</span> <span class='op'>-</span> <span class='va'>pred_congmesg0</span>
</code></pre>
</div>
</div>
<h4 id="natural-indirect-effect-nie">Natural indirect effect (NIE)</h4>
<p>NDE is the difference in the outcome between the actual control group
and a counterfactual control group. The counterfactual here is a control
group that did not receive the treatment, but had their <code>emo</code>
value set to be equal to the treatment group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1235</span><span class='op'>)</span>
<span class='co'># Simulated emo with tone = 0</span>
<span class='va'>sim_emo0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_emo_Intercept</span>,
                  mean <span class='op'>=</span> <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_emo_Intercept</span>,
                  sd <span class='op'>=</span> <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>sigma_emo</span><span class='op'>)</span>
<span class='co'># Counterfactuals for the same individuals with tone = 1</span>
<span class='va'>sim_emo1</span> <span class='op'>&lt;-</span> <span class='va'>sim_emo0</span> <span class='op'>+</span> <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_emo_tone</span>
<span class='co'># Predicted cong_mesg for tone = 0, emo = sim_emo0</span>
<span class='va'>pred_congmesg0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span> <span class='co'># apply the inverse probit link</span>
    <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_Intercept</span> <span class='op'>+</span>
        <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_emo</span> <span class='op'>*</span> <span class='va'>sim_emo0</span>
<span class='op'>)</span>
<span class='co'># Predicted cong_mesg for tone = 0, emo = sim_emo1</span>
<span class='va'>pred_congmesg1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span> <span class='co'># apply the inverse probit link</span>
    <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_Intercept</span> <span class='op'>+</span>
        <span class='va'>post_draws</span><span class='op'>$</span><span class='va'>b_congmesg_emo</span> <span class='op'>*</span> <span class='va'>sim_emo1</span>
<span class='op'>)</span>
<span class='co'># Natural direct effect</span>
<span class='va'>nie</span> <span class='op'>&lt;-</span> <span class='va'>pred_congmesg1</span> <span class='op'>-</span> <span class='va'>pred_congmesg0</span>
<span class='fu'><a href='https://rdrr.io/pkg/brms/man/draws-brms.html'>as_draws</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>NDE <span class='op'>=</span> <span class='va'>nde</span>, NIE <span class='op'>=</span> <span class='va'>nie</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://mc-stan.org/bayesplot/reference/MCMC-intervals.html'>mcmc_areas</a></span><span class='op'>(</span>bw <span class='op'>=</span> <span class='st'>"SJ"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/nie-ave-pop-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h3 id="sensitivity-analysis">Sensitivity analysis</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      T -&gt; C; T -&gt; E; E -&gt; C; U -&gt; E; U -&gt; C
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag6</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>T <span class='op'>=</span> <span class='fl'>0</span>, E <span class='op'>=</span> <span class='fl'>1</span>, C <span class='op'>=</span> <span class='fl'>2</span>, U <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>T <span class='op'>=</span> <span class='fl'>0</span>, E <span class='op'>=</span> <span class='fl'>1</span>, C <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag6</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag6-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>One important assumption in mediation is that there is no unobserved
confounding variable between the mediator and the outcome. This
assumption requires researchers’ input, as usually we don’t have studies
that randomly assign both the treatment variable and the mediator. An
additional technique is to ask: what would the effect be if there were
unobserved confounding variables of a certain magnitude? With Bayesian,
we can represent the strength of the confounding effect by a prior
distribution. The following shows the mediation estimates assuming a
N(0.5, 0.2) prior to the confounding effect.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb4"><pre
class="sourceCode stan"><code class="sourceCode stan"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N0;  <span class="co">// number of observations (control)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N1;  <span class="co">// number of observations (treatment)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y0[N0];  <span class="co">// outcome (control);</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> y1[N1];  <span class="co">// outcome (treatment);</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N0] m0;  <span class="co">// mediator (control);</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N1] m1;  <span class="co">// mediator (treatment);</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alpham;  <span class="co">// regression intercept for M</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alphay;  <span class="co">// regression intercept for M</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta1;   <span class="co">// X -&gt; M</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta2;   <span class="co">// X -&gt; Y</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta3;   <span class="co">// M -&gt; Y</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N0] u0;  <span class="co">// confounding variable</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N1] u1;  <span class="co">// confounding variable</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta4;   <span class="co">// U -&gt; Y</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigmam;  <span class="co">// SD of prediction error for M</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// model</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  u0 ~ std_normal();</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  u1 ~ std_normal();</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  m0 ~ normal(alpham + u0, sigmam);</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  m1 ~ normal(alpham + beta1 + u1, sigmam);</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  y0 ~ bernoulli_logit(alphay + beta3 * m0 + beta4 * u0);</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  y1 ~ bernoulli_logit(alphay + beta2 + beta3 * m1 + beta4 * u1);</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prior</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  alpham ~ normal(<span class="fl">4.5</span>, <span class="fl">4.5</span>);</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  alphay ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  beta1 ~ std_normal();</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  beta2 ~ std_normal();</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  beta3 ~ std_normal();</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  beta4 ~ normal(<span class="fl">0.5</span>, <span class="fl">0.2</span>);</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  sigmam ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 1. form the data list for Stan</span>
<span class='va'>stan_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>framing</span>,
                 <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>N0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span>,
                      N1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>,
                      m0 <span class='op'>=</span> <span class='va'>emo</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>]</span>,
                      m1 <span class='op'>=</span> <span class='va'>emo</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span>,
                      y0 <span class='op'>=</span> <span class='va'>cong_mesg</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>]</span>,
                      y1 <span class='op'>=</span> <span class='va'>cong_mesg</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tone</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># 2. Run Stan</span>
<span class='va'>m_med_sens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></span><span class='op'>(</span>
    file <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"stan"</span>, <span class='st'>"mediation_logit_normal_sensitivity.stan"</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='va'>stan_dat</span>,
    seed <span class='op'>=</span> <span class='fl'>1338</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>,
    <span class='co'># Exclude u0 and u1</span>
    pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"u0"</span>, <span class='st'>"u1"</span><span class='op'>)</span>, include <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_med_sens</span>
</code></pre>
</div>
<pre><code>#&gt; Inference for Stan model: mediation_logit_normal_sensitivity.
#&gt; 4 chains, each with iter=4000; warmup=2000; thin=1; 
#&gt; post-warmup draws per chain=2000, total post-warmup draws=8000.
#&gt; 
#&gt;           mean se_mean    sd    2.5%     25%     50%     75%   97.5%
#&gt; alpham    3.46    0.00  0.23    3.00    3.30    3.46    3.62    3.91
#&gt; alphay   -1.87    0.00  0.32   -2.52   -2.08   -1.86   -1.65   -1.27
#&gt; beta1     1.02    0.00  0.32    0.41    0.81    1.02    1.23    1.65
#&gt; beta2    -0.08    0.00  0.29   -0.64   -0.28   -0.08    0.12    0.50
#&gt; beta3     0.26    0.00  0.06    0.15    0.22    0.26    0.30    0.38
#&gt; beta4     0.52    0.00  0.20    0.13    0.38    0.52    0.66    0.92
#&gt; sigmam    2.54    0.00  0.13    2.30    2.45    2.54    2.62    2.80
#&gt; lp__   -656.48    0.23 12.39 -681.63 -664.63 -656.25 -647.94 -633.03
#&gt;        n_eff Rhat
#&gt; alpham  8285    1
#&gt; alphay  8779    1
#&gt; beta1   7833    1
#&gt; beta2  13005    1
#&gt; beta3   8370    1
#&gt; beta4   4808    1
#&gt; sigmam 10344    1
#&gt; lp__    2792    1
#&gt; 
#&gt; Samples were drawn using NUTS(diag_e) at Sat Apr 16 16:01:20 2022.
#&gt; For each parameter, n_eff is a crude measure of effective sample size,
#&gt; and Rhat is the potential scale reduction factor on split chains (at 
#&gt; convergence, Rhat=1).</code></pre>
</div>
<p>As you can see, the prior of the confounding effect attenuates the
coefficients from the mediator to the outcome, but the path from the
mediator to the outcome remains pretty much above zero.</p>
<h1 id="collider">Collider</h1>
<p>A collider is a descendant of two parent nodes. When one holds the
collider constant, it induces a spurious association between the
parents. This leads to many unexpected results in data analysis and
daily lives. For example, consider people who are nice and who are
good-looking. Is there an association between a person being nice and a
person being good-looking? Maybe. But this association can be induced
when we condition on a collider. Let’s say a friend of yours only dates
people who are either nice or good-looking. So we have this colliding
relation:</p>
<p>Nice → Dating ← Good looking</p>
<p>If you look at just the people that your friend dated, they are
either nice or good looking, but the fact that you select to look at
(condition on) only the people that your friend dated would
automatically eliminate people who are neither nice nor good looking.
This induces a spurious negative association between nice and good
looking, so your friend may believe that people who are nice would be
less likely to have appearances that fit their taste, and vice
versa.</p>
<p>As another example, is research that is newsworthy less trustworthy?
There could be a negative association due to collider bias, because
people who select research to be reported, funded, or published,
consider both newsworthiness and trustworthiness. Assume that
trustworthiness has no causal relation with newsworthiness, below shows
what happens when we only focus on papers that are either high on
newsworthiness or trustworthiness:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>2221</span><span class='op'>)</span> <span class='co'># different seed from the text</span>
<span class='va'>num_proposals</span> <span class='op'>&lt;-</span> <span class='fl'>200</span> <span class='co'># number of grant proposals</span>
<span class='va'>prop_selected</span> <span class='op'>&lt;-</span> <span class='fl'>0.1</span> <span class='co'># proportion to select</span>
<span class='co'># Simulate independent newsworthiness and trustworthiness</span>
<span class='va'>plot_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span> <span class='co'># `tibble` is the tidyverse version of `data.frame`</span>
    nw <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>num_proposals</span><span class='op'>)</span>,
    tw <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>num_proposals</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='va'>plot_dat</span> <span class='op'>&lt;-</span> <span class='va'>plot_dat</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>total <span class='op'>=</span> <span class='va'>nw</span> <span class='op'>+</span> <span class='va'>tw</span><span class='op'>)</span>
<span class='va'>sel_dat</span> <span class='op'>&lt;-</span> <span class='va'>plot_dat</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='co'># select top 10% of combined scores</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>order_by <span class='op'>=</span> <span class='va'>total</span>, prop <span class='op'>=</span> <span class='va'>prop_selected</span><span class='op'>)</span>
<span class='va'>plot_dat</span> <span class='op'><a href='https://rdrr.io/pkg/ggdag/man/pipe.html'>%&gt;%</a></span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>nw</span>, y <span class='op'>=</span> <span class='va'>tw</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>sel_dat</span>, shape <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>3</span>,
               color <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>, se <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>sel_dat</span>, method <span class='op'>=</span> <span class='st'>"lm"</span>, se <span class='op'>=</span> <span class='cn'>FALSE</span>,
                col <span class='op'>=</span> <span class='st'>"purple"</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"newsworthiness"</span>, y <span class='op'>=</span> <span class='st'>"trustworthiness"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/code-6-1-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>As you can see, a negative correlation happens. This is collider
bias: spurious correlation due to conditioning on the common descendant.
This also goes by the name Berkson’s Paradox.</p>
<aside>
See <a href="https://brilliant.org/wiki/berksons-paradox/"
class="uri">https://brilliant.org/wiki/berksons-paradox/</a> for some
more examples of Berkson’s Paradox.
</aside>
<p>In the DAG below, X and Y have no causal association. Conditioning on
S, however, induces a negative correlation between X and Y. With the DAG
below,</p>
<blockquote>
<p>Generally speaking, do not condition on a collider, unless you’re
going to de-confound the spurious association using other variables</p>
</blockquote>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag7</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      X -&gt; Y; X -&gt; S; Y -&gt; S
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag7</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, S <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='fl'>0</span>, S <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag7</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag7-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>Some other collider examples:</p>
<ul>
<li>impulsivity → high-risk youth ← delinquency</li>
<li>healthcare worker → COVID-19 testing ← COVID-19
severity<sup>2</sup></li>
<li>standardized test → admission ← research skills</li>
<li>maternal smoking → birth weight → birth defect ← mortality</li>
</ul>
<h1 id="instrumental-variable">Instrumental Variable</h1>
<p>Consider the following diagram:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dag8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/dagitty.html'>dagitty</a></span><span class='op'>(</span>
    <span class='st'>"dag{
      Z -&gt; X; X -&gt; Y; U -&gt; X; U -&gt; Y
    }"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/VariableStatus.html'>latents</a></span><span class='op'>(</span><span class='va'>dag8</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"U"</span>
<span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/coordinates.html'>coordinates</a></span><span class='op'>(</span><span class='va'>dag8</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Z <span class='op'>=</span> <span class='fl'>0</span>, X <span class='op'>=</span> <span class='fl'>1</span>, Y <span class='op'>=</span> <span class='fl'>3</span>, U <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
                          y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Z <span class='op'>=</span> <span class='fl'>0</span>, X <span class='op'>=</span> <span class='fl'>0</span>, Y <span class='op'>=</span> <span class='fl'>0</span>, U <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/ggdag.html'>ggdag</a></span><span class='op'>(</span><span class='va'>dag8</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/ggdag/man/theme_dag_blank.html'>theme_dag</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/dag8-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>We want to estimate the causal effect from X to Y. However, there is
an unobserved confounder, U. Because U is not observed, we cannot block
this path, so we cannot apply the back-door criterion.</p>
<p>However, notice the variable Z in the DAG. In the diagram, Z has the
causal effect of changing X through a mechanism that does not involve U.
Therefore, any effect that Z has on Y will be through X, but does not
involve U. In a linear model, if we can obtain the coefficient of Z → X,
denoted as b1, and the coefficient of Z → Y, denoted as b2, then an
estimate of the causal effect of X → Y is</p>
<p><span class="math display">\[\text{causal effect}(X \to Y) =
\frac{\text{causal effect}(Z \to Y)}{\text{causal effect}(Z \to
X)}\]</span></p>
<p>The <code>dagitty</code> package contains a function for identifying
instrumental variables, given a specified DAG:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>dagitty</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dagitty/man/instrumentalVariables.html'>instrumentalVariables</a></span><span class='op'>(</span><span class='va'>dag8</span>,
                               exposure <span class='op'>=</span> <span class='st'>"X"</span>,
                               outcome <span class='op'>=</span> <span class='st'>"Y"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>#&gt;  Z</code></pre>
</div>
<p>Here’s an example with the <code>jobs</code> data set from the
<code>mediation</code> package. You can obtain more information from the
documentation page.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>jobs</span>, package <span class='op'>=</span> <span class='st'>"mediation"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Instrumental variables can be used for both experimental and
nonexperimental studies. In this example, while individuals are randomly
assigned to participate in a job training intervention, not everyone
assigned to the intervention group participated. In this data,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>jobs</span>, <span class='va'>treat</span>, <span class='va'>comply</span><span class='op'>)</span>  <span class='co'># only 372 out of 600 complied</span>
</code></pre>
</div>
<pre><code>#&gt;   treat comply   n
#&gt; 1     0      0 299
#&gt; 2     1      0 228
#&gt; 3     1      1 372</code></pre>
</div>
<p>And those who decided to participate may have different
characteristics from those who did not participate, and such differences
may lead to differences in the outcome. Therefore, we can distinguish
two kinds of effects when talking about intervention:</p>
<ul>
<li>Intent-to-treat (ITT) effect: the average effect of
<em>assigning</em> people to the job training intervention
condition</li>
<li>Complier average causal eﬀect (CACE): the average effect of the
intervention on those who complied with the intervention; also called
the treatment-on-the-treated effect.</li>
</ul>
<p>In this example, Z is the random assignment, X is the actual
participation in the program, and Y is a posttest measure of depressive
symptoms. Z is a potential instrumental variable, which has to satisfy
the following conditions:</p>
<ul>
<li>No direct path from Z to Y; Z affects Y only through X (exclusion
restriction)</li>
<li>No unobserved confounding between Z and Y (ignorability)</li>
</ul>
<p>In addition, a <em>strong instrument</em> is one where Z has a strong
effect on X. If Z only slightly causes X, the instrumental variable
approach is not good.</p>
<p>In our example, the exclusion restriction assumption means being
assigned to the intervention condition does not affect the outcome if
participants never participate in the intervention. The ignorability
assumption means that there is no common cause of a person being
assigned to an intervention and their outcome, which is justified here
given Z is randomized. In a nonexperimental study, this may require
identifying confounders and adjusting for those confounders between Z
and Y.</p>
<h2 id="intention-to-treat-effect">Intention-To-Treat Effect</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_itt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>depress2</span> <span class='op'>~</span> <span class='va'>treat</span>,
             data <span class='op'>=</span> <span class='va'>jobs</span>,
             prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span> <span class='op'>+</span>
                 <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>,
             seed <span class='op'>=</span> <span class='fl'>1244</span>, iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>m_itt</span>, variable <span class='op'>=</span> <span class='st'>"b_treat"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/plot-itt-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="complier-average-causal-eﬀect">Complier Average Causal
Eﬀect</h2>
<p>If we only estimate <code>comply</code> → <code>despress2</code>, the
coefficient may be confounded because <code>comply</code> is not
randomly assigned. <strong>So the following may not be an accurate
causal effect estimate:</strong></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_comply</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span><span class='va'>depress2</span> <span class='op'>~</span> <span class='va'>comply</span>,
                prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span> <span class='op'>+</span>
                    <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>,
                data <span class='op'>=</span> <span class='va'>jobs</span>, seed <span class='op'>=</span> <span class='fl'>1244</span>, iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We can use an instrumental variable approach. This can be done with
<code>brms</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>comply</span> <span class='op'>~</span> <span class='va'>treat</span><span class='op'>)</span>  <span class='co'># Need to treat outcome as linear</span>
<span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula.html'>bf</a></span><span class='op'>(</span><span class='va'>depress2</span> <span class='op'>~</span> <span class='va'>comply</span><span class='op'>)</span>
<span class='va'>m_iv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brm.html'>brm</a></span><span class='op'>(</span>
    <span class='va'>f1</span> <span class='op'>+</span> <span class='va'>f2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/brmsformula-helpers.html'>set_rescor</a></span><span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span>,  <span class='co'># need `set_rescor(TRUE)` for unobserved U</span>
    data <span class='op'>=</span> <span class='va'>jobs</span>,
    prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>2.5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span>, resp <span class='op'>=</span> <span class='st'>"comply"</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span>, resp <span class='op'>=</span> <span class='st'>"depress2"</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span>, resp <span class='op'>=</span> <span class='st'>"comply"</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'><a href='https://rdrr.io/pkg/brms/man/set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>student_t</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"sigma"</span>, resp <span class='op'>=</span> <span class='st'>"depress2"</span><span class='op'>)</span>,
    seed <span class='op'>=</span> <span class='fl'>1244</span>, iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The CACE effect was higher than the ITT effect, but also with more
uncertainty:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>m_iv</span>, variable <span class='op'>=</span> <span class='st'>"b_depress2_comply"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="causal_inference_files/figure-html5/plot-iv-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>Note: <code>brms</code> only supports IV for normal outcomes. A more
general approach is to code the model in Stan, as below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb8"><pre
class="sourceCode stan"><code class="sourceCode stan"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;  <span class="co">// number of observations</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;  <span class="co">// outcome;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] z;  <span class="co">// instrument;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> x[N];  <span class="co">// binary treatment/causal variable;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x_real = to_vector(x);</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alphax;  <span class="co">// regression intercept for X</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> alphay;  <span class="co">// regression intercept for Y</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta1;   <span class="co">// Z -&gt; X</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta2;   <span class="co">// X -&gt; Y</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] u;  <span class="co">// confounding variable</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> beta3;   <span class="co">// U -&gt; Y</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;  <span class="co">// SD of prediction error for Y</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// model</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  u ~ std_normal();</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  x ~ bernoulli_logit(alphax + beta1 * z + u);</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  y ~ normal(alphay + beta2 * x_real + beta3 * u, sigma);</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prior</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  beta1 ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  beta2 ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  beta3 ~ normal(<span class="dv">0</span>, <span class="dv">2</span>);</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  sigma ~ student_t(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">3</span>);</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 1. form the data list for Stan</span>
<span class='va'>stan_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>jobs</span>,
                 <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>jobs</span><span class='op'>)</span>,
                      y <span class='op'>=</span> <span class='va'>depress2</span>,
                      x <span class='op'>=</span> <span class='va'>comply</span>,
                      z <span class='op'>=</span> <span class='va'>treat</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># 2. Run Stan</span>
<span class='va'>m_iv_stan</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a></span><span class='op'>(</span>
    file <span class='op'>=</span> <span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"stan"</span>, <span class='st'>"iv_logit_normal.stan"</span><span class='op'>)</span>,
    data <span class='op'>=</span> <span class='va'>stan_dat</span>,
    seed <span class='op'>=</span> <span class='fl'>1338</span>,
    <span class='co'># Exclude u</span>
    pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"u"</span><span class='op'>)</span>, include <span class='op'>=</span> <span class='cn'>FALSE</span>,
    iter <span class='op'>=</span> <span class='fl'>4000</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<!-- The following chunk is only used in the website -->
<section id="last-updated" class="appendix layout-chunk"
data-layout="l-body">
<h2 class="appendix">Last updated</h2>
<div class="layout-chunk" data-layout="l-body">
<pre><code>#&gt; [1] &quot;April 02, 2022&quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="sourceCode" id="cb10"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
</section>
<div class="sourceCode" id="cb11"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/marklhc/20221-psyc573-usc/issues/new">create an issue</a> on the source repository.</p>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>. Source code is available at <a href="https://github.com/marklhc/20221-psyc573-usc">https://github.com/marklhc/20221-psyc573-usc</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2022 Hok Chio (Mark) Lai</p>
<p>Template by <a
href="https://github.com/distillpub/template/blob/master/AUTHORS">The
Distill Template Authors</a> and <a
href="https://www.rstudio.com">RStudio, Inc</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
